(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5807:function(e,a,s){Promise.resolve().then(s.bind(s,3273))},3273:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return u}});var l=s(7437),n=s(2265),i=s(4033),t=s(6691),c=s.n(t);function r(e){let{title:a,subtitle:s,timestamps:n,series:i}=e,t=n[0]?new Date(n[0]).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"—",c=n[n.length-1]?new Date(n[n.length-1]).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"—";return(0,l.jsxs)("div",{className:"chart-card",children:[(0,l.jsxs)("div",{className:"chart-header",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{children:a}),s&&(0,l.jsx)("span",{className:"small",children:s})]}),(0,l.jsx)("div",{className:"chart-legend",children:i.map(e=>(0,l.jsxs)("span",{className:"legend-chip",children:[(0,l.jsx)("span",{className:"dot",style:{background:e.color}}),e.label]},e.label))})]}),(0,l.jsxs)("svg",{viewBox:"0 0 ".concat(320," ").concat(120),className:"chart-svg",role:"img",children:[(0,l.jsx)("path",{className:"chart-gridline",d:"M0 ".concat(120," H").concat(320)}),(0,l.jsx)("path",{className:"chart-gridline",d:"M0 ".concat(79.2," H").concat(320)}),(0,l.jsx)("path",{className:"chart-gridline",d:"M0 ".concat(39.6," H").concat(320)}),i.map(e=>(0,l.jsx)("path",{d:function(e,a,s){if(0===e.length)return"";let l=Math.max(1,...e),n=e.length>1?320/(e.length-1):0;return e.map((e,a)=>"".concat(0===a?"M":"L").concat((a*n).toFixed(2),",").concat((s-e/l*s).toFixed(2))).join(" ")}(e.data,0,120),fill:"none",stroke:e.color,strokeWidth:"2"},e.label))]}),(0,l.jsxs)("div",{className:"chart-footer small",children:[(0,l.jsx)("span",{children:t}),(0,l.jsx)("span",{children:c})]})]})}function o(e){let{title:a,subtitle:s,slices:n}=e;return(0,l.jsxs)("div",{className:"pie-card",children:[(0,l.jsxs)("div",{className:"pie-title",children:[(0,l.jsx)("h4",{children:a}),s&&(0,l.jsx)("span",{className:"small",children:s})]}),(0,l.jsx)("div",{className:"pie",style:{background:function(e){let a=e.reduce((e,a)=>e+a.value,0)||1,s=0,l=e.map(e=>{let l=e.value/a*100,n=s+l,i="".concat(e.color," ").concat(s.toFixed(2),"% ").concat(n.toFixed(2),"%");return s=n,i});return"conic-gradient(".concat(l.join(", "),")")}(n)}}),(0,l.jsx)("div",{className:"legend-grid",children:n.map(e=>(0,l.jsxs)("div",{className:"legend-item",children:[(0,l.jsx)("span",{className:"dot",style:{background:e.color}}),(0,l.jsx)("span",{children:e.label}),(0,l.jsx)("strong",{children:e.value})]},e.label))})]})}var d={src:"/_next/static/media/image-removebg-preview (1).e42d1c3e.png",height:373,width:306,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAYAAAA1BOUGAAAAYElEQVR42o2OSwqAMAxEtRt3rsQrdSGIFHHh/bH5THoGxxPUwBAmZIY3dEdFk7unFkG15Gapn4JjVpGD3yWAMxCXqe5S6zLwuNLcbl6oTL+ZWpanTt3a8QMAgQBw4x/QCzGdSC2iRVeDAAAAAElFTkSuQmCC",blurWidth:7,blurHeight:8},h={src:"/_next/static/media/image-removebg-preview (2).3fd3de60.png",height:128,width:414,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAYAAABllJ3tAAAATUlEQVR4nAFCAL3/AUhkfDr78fQFChMQ8uS4ziADDwf1/fP6+AEHBAz+8vrkAU1rgzjy4ucFHzw08vz29hYAAgL1//39DgH///cTICDnPO0hq4RY6ksAAAAASUVORK5CYII=",blurWidth:8,blurHeight:2};let m=()=>({peopleIn:0,peopleOut:0,faceEvents:0,facesDetected:0,gender:{male:0,female:0,unknown:0},age:{avg:null},glasses:{yes:0,no:0,unknown:0},lastEventAt:null});function u(){var e,a;let s=(0,i.useRouter)(),[t,u]=(0,n.useState)([]),[p,v]=(0,n.useState)(null),[x,j]=(0,n.useState)(""),[g,N]=(0,n.useState)([]),[f,y]=(0,n.useState)(24),[b,A]=(0,n.useState)(null),[w,C]=(0,n.useState)([]),[k,S]=(0,n.useState)(""),[I,O]=(0,n.useState)(()=>new Date().toLocaleDateString("en-CA")),[E,z]=(0,n.useState)([]),[T,D]=(0,n.useState)(!1),[M,R]=(0,n.useState)(null),[U,F]=(0,n.useState)("camera"),[P,L]=(0,n.useState)(""),[B,G]=(0,n.useState)(""),[H,_]=(0,n.useState)(""),[Y,Q]=(0,n.useState)(""),[J,V]=(0,n.useState)(null),[W,Z]=(0,n.useState)(null),[q,K]=(0,n.useState)(!1),[X,$]=(0,n.useState)({}),[ee,ea]=(0,n.useState)({}),[es,el]=(0,n.useState)(null),[en,ei]=(0,n.useState)(!0),et=(null==es?void 0:es.role)==="admin",ec=(0,n.useMemo)(()=>t.filter(e=>!e.parentCameraId),[t]),er=e=>{j(e.ip)},eo=(0,n.useMemo)(()=>ec.slice().sort((e,a)=>(e.name||e.ip).localeCompare(a.name||a.ip)),[ec]),ed=(0,n.useMemo)(()=>({total:t.length,cameras:t.filter(e=>"camera"===e.deviceType).length,aiBoxes:t.filter(e=>"ai_box"===e.deviceType).length,zones:w.length}),[t,w.length]),eh=(0,n.useMemo)(()=>p?p.channels.reduce((e,a)=>(e.peopleIn+=a.stats.peopleIn,e.peopleOut+=a.stats.peopleOut,e.faceEvents+=a.stats.faceEvents,e.facesDetected+=a.stats.facesDetected,e.occupancy+=Math.max(0,a.stats.peopleIn-a.stats.peopleOut),e),{peopleIn:0,peopleOut:0,faceEvents:0,facesDetected:0,occupancy:0}):null,[p]),em=(0,n.useMemo)(()=>{if(!p)return[];let e=new Set;for(let s of p.channels){var a;let l=null===(a=s.zone)||void 0===a?void 0:a.trim();l&&e.add(l)}return Array.from(e).sort((e,a)=>e.localeCompare(a))},[p]),eu=(0,n.useMemo)(()=>E.reduce((e,a)=>(e.peopleIn+=a.stats.peopleIn,e.peopleOut+=a.stats.peopleOut,e.faceEvents+=a.stats.faceEvents,e.facesDetected+=a.stats.facesDetected,e.occupancy+=Math.max(0,a.stats.peopleIn-a.stats.peopleOut),e),{peopleIn:0,peopleOut:0,faceEvents:0,facesDetected:0,occupancy:0}),[E]),ep=(0,n.useMemo)(()=>new Set(E.map(e=>e.cameraId)).size,[E]),ev=(0,n.useMemo)(()=>b?[{label:"Male",value:b.gender.male,color:"var(--accent-2)"},{label:"Female",value:b.gender.female,color:"var(--danger)"},{label:"Unknown",value:b.gender.unknown,color:"var(--accent)"}]:null,[b]),ex=(0,n.useMemo)(()=>b?[{label:"Child",value:b.age.child,color:"var(--accent-2)"},{label:"Teen",value:b.age.teen,color:"var(--signal)"},{label:"Young",value:b.age.youngAdult,color:"var(--accent)"},{label:"Middle",value:b.age.middleAge,color:"#8fa2b9"},{label:"Senior",value:b.age.senior,color:"var(--danger)"},{label:"Unknown",value:b.age.unknown,color:"#c2b7aa"}]:null,[b]),ej=(0,n.useMemo)(()=>{let e=new Date,a=Math.max(1,f),s=[];for(let l=a-1;l>=0;l-=1){let a=new Date(e.getTime()-36e5*l);a.setMinutes(0,0,0),s.push(a.toISOString())}return s},[f]),eg=(0,n.useMemo)(()=>{let e=new Map;for(let a of g)e.set(function(e){let a=new Date(e);return a.setMinutes(0,0,0),a.toISOString()}(a.t),a);return{peopleIn:ej.map(a=>{var s,l;return null!==(l=null===(s=e.get(a))||void 0===s?void 0:s.peopleIn)&&void 0!==l?l:0}),peopleOut:ej.map(a=>{var s,l;return null!==(l=null===(s=e.get(a))||void 0===s?void 0:s.peopleOut)&&void 0!==l?l:0}),faces:ej.map(a=>{var s,l;return null!==(l=null===(s=e.get(a))||void 0===s?void 0:s.faces)&&void 0!==l?l:0}),timestamps:ej}},[g,ej]),eN=e=>{if(!e)return"—";let a=new Date(e);return Number.isNaN(a.getTime())?e:new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Riyadh",day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)},ef=e=>null===e||Number.isNaN(e)?"Unknown":e<13?"Child":e<20?"Teen":e<40?"Young adult":e<60?"Middle age":"Senior",ey=e=>ef(e),eb=e=>"string"==typeof e&&/face/i.test(e),eA=(e,a,s,l)=>{let n=e=>"string"==typeof e&&/(face|fece)/i.test(e),i="string"==typeof s?s:s?JSON.stringify(s):"";return n(e)||a.some(n)||i&&/face/i.test(i)||l.faceEvents>0||l.facesDetected>0},ew=e=>[{label:"Male",value:e.gender.male,color:"var(--accent-2)"},{label:"Female",value:e.gender.female,color:"var(--danger)"},{label:"Unknown",value:e.gender.unknown,color:"var(--accent)"}],eC=e=>[{label:"Child",value:e.child,color:"var(--accent-2)"},{label:"Teen",value:e.teen,color:"var(--signal)"},{label:"Young",value:e.youngAdult,color:"var(--accent)"},{label:"Middle",value:e.middleAge,color:"#8fa2b9"},{label:"Senior",value:e.senior,color:"var(--danger)"},{label:"Unknown",value:e.unknown,color:"#c2b7aa"}],ek=e=>{let a=Math.max(0,e.peopleIn-e.peopleOut);return[{label:"In",value:e.peopleIn,color:"var(--accent)"},{label:"Out",value:e.peopleOut,color:"var(--signal)"},{label:"Occupancy",value:a,color:"var(--accent-2)"}]},eS=async()=>{try{let e=await fetch("/api/camera/list"),a=await e.json();e.ok&&a.ok&&(u(a.cameras),!x&&a.cameras.length>0&&j(a.cameras[0].ip))}catch(e){console.error(e)}},eI=async()=>{try{let e=I?"/api/overview?day=".concat(encodeURIComponent(I)):"/api/overview",a=await fetch(e),s=await a.json();a.ok&&s.ok&&A(s)}catch(e){console.error(e)}},eO=async()=>{try{let e=await fetch("/api/zone/list"),a=await e.json();e.ok&&a.ok&&(C(a.zones),!k&&a.zones.length>0&&S(a.zones[0]))}catch(e){console.error(e)}},eE=async e=>{D(!0),R(null);try{let a=I?"/api/zone/channels?zone=".concat(encodeURIComponent(e),"&day=").concat(encodeURIComponent(I)):"/api/zone/channels?zone=".concat(encodeURIComponent(e)),s=await fetch(a),l=await s.json();if(!s.ok||!l.ok)throw Error(l.error||"Failed to load zone channels.");z(l.channels)}catch(e){var a;z([]),R(null!==(a=e.message)&&void 0!==a?a:"Failed to load zone channels.")}finally{D(!1)}},ez=async e=>{try{let a=I?"&day=".concat(encodeURIComponent(I)):"",[s,l,n]=await Promise.all([fetch("/api/camera/detail?ip=".concat(encodeURIComponent(e))),fetch("/api/camera/stats?ip=".concat(encodeURIComponent(e)).concat(a)),fetch("/api/camera/timeseries?ip=".concat(encodeURIComponent(e),"&hours=").concat(f).concat(a))]),i=await s.json(),t=await l.json(),c=await n.json();if(!s.ok||!i.ok)throw Error(i.error||"Failed to load device.");let r=new Map;if(t.ok)for(let e of t.stats.channels)r.set(e.channelId,e.stats);let o=i.channels.map(e=>{var a,s,l,n,i;return{id:e.id,name:(null===(a=e.name)||void 0===a?void 0:a.trim())?e.name:"Channel ".concat(e.id),zone:null!==(s=e.zone)&&void 0!==s?s:null,features:null!==(l=e.features)&&void 0!==l?l:[],capabilities:null!==(n=e.capabilities)&&void 0!==n?n:null,stats:null!==(i=r.get(e.id))&&void 0!==i?i:m()}});v({ip:i.ip,name:i.name,deviceType:i.deviceType,zone:i.zone,updatedAt:i.updatedAt,channels:o}),c.ok&&N(c.series)}catch(e){console.error(e)}},eT=async(e,a)=>{if(!(null==p?void 0:p.ip)||!et)return;let s=a.trim();$(a=>({...a,[e]:!0}));try{let a=await fetch("/api/camera/channel",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:p.ip,channelId:e,name:s})}),l=await a.json();if(!a.ok||!l.ok)throw Error(l.error||"Failed to update channel name");v(a=>a?{...a,channels:a.channels.map(a=>{var s,n,i;return a.id===e?{...a,name:null!==(s=l.name)&&void 0!==s?s:"",zone:null!==(i=null!==(n=l.zone)&&void 0!==n?n:a.zone)&&void 0!==i?i:null}:a})}:a)}catch(e){console.error(e)}finally{$(a=>({...a,[e]:!1}))}},eD=async(e,a)=>{if(!(null==p?void 0:p.ip)||!et)return;let s=a.trim();$(a=>({...a,[e]:!0}));try{let a=await fetch("/api/camera/channel",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:p.ip,channelId:e,zone:s})}),l=await a.json();if(!a.ok||!l.ok)throw Error(l.error||"Failed to update channel zone");v(a=>a?{...a,channels:a.channels.map(a=>{var s,n;return a.id===e?{...a,zone:null!==(s=l.zone)&&void 0!==s?s:null,name:null!==(n=l.name)&&void 0!==n?n:a.name}:a})}:a)}catch(e){console.error(e)}finally{$(a=>({...a,[e]:!1}))}},eM=async e=>{if((null==p?void 0:p.ip)&&et){ea(a=>({...a,[e]:!0}));try{let a=await fetch("/api/camera/people-count/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:p.ip,channelId:e})}),s=await a.json();if(!a.ok||!s.ok)throw Error(s.error||"Reset failed");v(a=>a?{...a,channels:a.channels.map(a=>a.id===e?{...a,stats:{...a.stats,peopleIn:0,peopleOut:0,lastEventAt:null}}:a)}:a)}catch(e){console.error(e)}finally{ea(a=>({...a,[e]:!1}))}}},eR=async()=>{K(!0),Z(null),V(null);try{if(!B.trim()||!U)throw Error("Device IP and type are required.");if("camera"===U&&(!H||!Y))throw Error("Camera registration requires username and password.");if("camera"===U){let e=await fetch("/api/camera/connect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:B.trim(),username:H,password:Y,name:P,deviceType:"camera"})}),a=await e.json();if(!e.ok||!a.ok)throw Error(a.error||"Camera registration failed")}else{let e=await fetch("/api/device/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:B.trim(),name:P,deviceType:"ai_box",username:H,password:Y})}),a=await e.json();if(!e.ok||!a.ok)throw Error(a.error||"AI box registration failed")}await eS(),j(B.trim()),V("Device registered successfully.")}catch(a){var e;Z(null!==(e=a.message)&&void 0!==e?e:"Registration failed")}finally{K(!1)}},eU=async()=>{try{await fetch("/api/auth/logout",{method:"POST"})}finally{s.replace("/login")}};return((0,n.useEffect)(()=>{document.documentElement.dataset.theme="noir"},[]),(0,n.useEffect)(()=>{let e=!0;return(async()=>{try{let a=await fetch("/api/auth/me");if(!a.ok){s.replace("/login");return}let l=await a.json();e&&l.ok&&el(l.user)}catch(a){e&&s.replace("/login")}finally{e&&ei(!1)}})(),()=>{e=!1}},[s]),(0,n.useEffect)(()=>{eS(),eO()},[]),(0,n.useEffect)(()=>{x&&ez(x)},[x,f,I]),(0,n.useEffect)(()=>{if(!k){z([]);return}eE(k)},[k,I]),(0,n.useEffect)(()=>{eI()},[I]),en)?(0,l.jsxs)("div",{className:"loading-screen",children:[(0,l.jsx)("div",{className:"orb"}),(0,l.jsx)("p",{children:"Loading dashboard..."})]}):(0,l.jsxs)("div",{className:"page",children:[(0,l.jsxs)("header",{className:"topbar",children:[(0,l.jsxs)("div",{className:"brand",children:[(0,l.jsx)(c(),{src:d,alt:"EWC",width:120,height:120}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"brand-title",children:"EWC Command"}),(0,l.jsx)("div",{className:"small",children:"AI cameras + analytics"})]})]}),(0,l.jsxs)("div",{className:"topbar-actions",children:[(0,l.jsxs)("div",{className:"pill small-pill ghost",children:[null==es?void 0:es.username," (",null==es?void 0:es.role,")"]}),(0,l.jsx)("button",{className:"btn-ghost",onClick:eU,children:"Logout"})]})]}),(0,l.jsxs)("section",{className:"hero",children:[(0,l.jsxs)("div",{className:"hero-card",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"eyebrow",children:"Device Overview"}),(0,l.jsx)("h1",{children:"Registered devices by zone"}),(0,l.jsx)("p",{className:"small",children:"Connect AI boxes and cameras, then monitor people flow and occupancy from one view."})]}),(0,l.jsxs)("div",{className:"hero-stats",children:[(0,l.jsxs)("div",{className:"stat-chip",children:[(0,l.jsx)("span",{children:"Total"}),(0,l.jsx)("strong",{children:ed.total})]}),(0,l.jsxs)("div",{className:"stat-chip",children:[(0,l.jsx)("span",{children:"Cameras"}),(0,l.jsx)("strong",{children:ed.cameras})]}),(0,l.jsxs)("div",{className:"stat-chip",children:[(0,l.jsx)("span",{children:"AI Boxes"}),(0,l.jsx)("strong",{children:ed.aiBoxes})]}),(0,l.jsxs)("div",{className:"stat-chip",children:[(0,l.jsx)("span",{children:"Zones"}),(0,l.jsx)("strong",{children:ed.zones})]})]})]}),(0,l.jsxs)("div",{className:"hero-card",children:[(0,l.jsxs)("div",{className:"header-min",children:[(0,l.jsx)("h3",{children:"Register device"}),(0,l.jsx)("span",{className:"pill small-pill ghost",children:"Admin only"})]}),(0,l.jsxs)("div",{className:"form-grid",children:[(0,l.jsxs)("label",{children:["Type",(0,l.jsxs)("select",{value:U,onChange:e=>F(e.target.value),disabled:!et,children:[(0,l.jsx)("option",{value:"camera",children:"Camera"}),(0,l.jsx)("option",{value:"ai_box",children:"AI Box"})]})]}),(0,l.jsxs)("label",{children:["Device name",(0,l.jsx)("input",{value:P,onChange:e=>L(e.target.value),placeholder:"Entrance Cam 01",disabled:!et})]}),(0,l.jsxs)("label",{children:["IP address",(0,l.jsx)("input",{value:B,onChange:e=>G(e.target.value),placeholder:"192.168.1.45",disabled:!et})]}),(0,l.jsxs)("label",{children:["Username",(0,l.jsx)("input",{value:H,onChange:e=>_(e.target.value),placeholder:"admin",disabled:!et})]}),(0,l.jsxs)("label",{children:["Password",(0,l.jsx)("input",{type:"password",value:Y,onChange:e=>Q(e.target.value),placeholder:"••••••••",disabled:!et})]})]}),(0,l.jsxs)("div",{className:"actions",children:[(0,l.jsx)("button",{className:"btn-primary",onClick:eR,disabled:q||!et,children:q?"Registering...":"Register device"}),J&&(0,l.jsx)("span",{className:"pill small-pill",children:J}),W&&(0,l.jsx)("span",{className:"pill small-pill danger",children:W})]})]})]}),(0,l.jsxs)("section",{className:"layout",children:[(0,l.jsxs)("aside",{className:"panel device-list",children:[(0,l.jsxs)("div",{className:"header-min",children:[(0,l.jsx)("h3",{children:"Devices"}),(0,l.jsxs)("span",{className:"pill small-pill ghost",children:[t.length," total"]})]}),(0,l.jsx)("div",{className:"zone-list",children:(0,l.jsx)("div",{className:"device-cards",children:eo.map(e=>{let a=e.ip===x;return(0,l.jsxs)("button",{className:"device-card ".concat(a?"selected":""),onClick:()=>er(e),children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"camera-name",children:e.name||e.ip}),(0,l.jsx)("div",{className:"small",children:e.ip})]}),(0,l.jsxs)("div",{className:"device-meta",children:[(0,l.jsx)("span",{className:"pill small-pill ghost",children:"ai_box"===e.deviceType?"AI Box":"Camera"}),(0,l.jsxs)("span",{className:"small",children:[e.channelsTotal," ch"]})]})]},e.id)})})})]}),(0,l.jsxs)("div",{className:"stack",children:[b&&ev&&ex&&(0,l.jsxs)("section",{className:"panel",children:[(0,l.jsxs)("div",{className:"header-min",children:[(0,l.jsx)("h3",{children:"All devices stats"}),(0,l.jsxs)("div",{className:"actions",children:[(0,l.jsx)("input",{type:"date",value:I,onChange:e=>O(e.target.value)}),(0,l.jsx)("button",{className:"pill small-pill ghost",onClick:()=>O(new Date().toLocaleDateString("en-CA")),children:"Today"})]})]}),(0,l.jsxs)("div",{className:"device-summary",children:[(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"Total people in"}),(0,l.jsx)("div",{className:"value",children:b.totals.peopleIn}),(0,l.jsx)("span",{className:"small",children:"Across all devices"})]}),(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"Total people out"}),(0,l.jsx)("div",{className:"value",children:b.totals.peopleOut}),(0,l.jsx)("span",{className:"small",children:"Across all devices"})]})]}),(0,l.jsxs)("div",{className:"pie-grid",children:[(0,l.jsx)(o,{title:"Gender mix",subtitle:"Attributes",slices:ev}),(0,l.jsx)(o,{title:"Age range",subtitle:"Attributes",slices:ex})]})]}),(0,l.jsxs)("section",{className:"panel",children:[(0,l.jsxs)("div",{className:"header-min",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"Live device insight"}),(0,l.jsx)("span",{className:"small",children:(null==p?void 0:p.name)||(null==p?void 0:p.ip)||"Select a device"})]}),(0,l.jsxs)("div",{className:"actions",children:[(0,l.jsx)("button",{className:"pill small-pill ghost",onClick:()=>eS(),children:"Refresh list"}),(0,l.jsx)("button",{className:"pill small-pill ghost",onClick:()=>x&&ez(x),children:"Refresh stats"})]})]}),p?(0,l.jsxs)("div",{className:"device-summary",children:[(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"Channel zones"}),(0,l.jsx)("div",{className:"value",children:em.length}),(0,l.jsx)("span",{className:"small",children:em.length?em.join(", "):"No zones assigned"})]}),(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"Type"}),(0,l.jsx)("div",{className:"value",children:"ai_box"===p.deviceType?"AI Box":"Camera"}),(0,l.jsxs)("span",{className:"small",children:[p.channels.length," channels"]})]}),!eb(p.name)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"People in"}),(0,l.jsx)("div",{className:"value",children:null!==(e=null==eh?void 0:eh.peopleIn)&&void 0!==e?e:0}),(0,l.jsx)("span",{className:"small",children:"Total today"})]}),(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"People out"}),(0,l.jsx)("div",{className:"value",children:null!==(a=null==eh?void 0:eh.peopleOut)&&void 0!==a?a:0}),(0,l.jsx)("span",{className:"small",children:"Total today"})]})]})]}):(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("div",{className:"orb small"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"camera-name",children:"No device selected"}),(0,l.jsx)("p",{className:"small",children:"Choose a device from the left panel to load analytics."})]})]})]}),!eb(null==p?void 0:p.name)&&(0,l.jsxs)("section",{className:"panel",children:[(0,l.jsxs)("div",{className:"header-min",children:[(0,l.jsx)("h3",{children:"Flow timelines"}),(0,l.jsxs)("div",{className:"actions",children:[(0,l.jsx)("button",{className:"pill small-pill ghost ".concat(24===f?"active":""),onClick:()=>y(24),children:"24h"}),(0,l.jsx)("button",{className:"pill small-pill ghost ".concat(72===f?"active":""),onClick:()=>y(72),children:"3d"}),(0,l.jsx)("button",{className:"pill small-pill ghost ".concat(168===f?"active":""),onClick:()=>y(168),children:"7d"})]})]}),(0,l.jsx)("div",{className:"chart-grid",children:(0,l.jsx)(r,{title:"People flow",subtitle:"Entries vs exits",timestamps:eg.timestamps,series:[{label:"In",color:"var(--accent)",data:eg.peopleIn},{label:"Out",color:"var(--signal)",data:eg.peopleOut}]})})]}),p&&(0,l.jsxs)("section",{className:"panel",children:[(0,l.jsxs)("div",{className:"header-min",children:[(0,l.jsx)("h3",{children:"Channel analytics"}),(0,l.jsxs)("span",{className:"pill small-pill ghost",children:[p.channels.length," channels"]})]}),(0,l.jsx)("div",{className:"camera-grid",children:p.channels.map(e=>{var a,s;let n=eb(p.name),i=n||eA(e.name,e.features,e.capabilities,e.stats),t=!n&&!i&&e.features.some(e=>e.toLowerCase().includes("people"));return(0,l.jsxs)("div",{className:"camera-card",children:[(0,l.jsxs)("div",{className:"camera-header",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("input",{className:"camera-name-input",value:null!==(a=e.name)&&void 0!==a?a:"",placeholder:"Channel ".concat(e.id),disabled:!et,title:et?void 0:"Admin only",onChange:a=>{let s=a.target.value;v(a=>a?{...a,channels:a.channels.map(a=>a.id===e.id?{...a,name:s}:a)}:a)},onBlur:()=>{var a;return eT(e.id,null!==(a=e.name)&&void 0!==a?a:"")},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()}}),(0,l.jsxs)("div",{className:"small",children:["Channel ",e.id]}),(0,l.jsx)("input",{className:"camera-name-input channel-zone-input",value:null!==(s=e.zone)&&void 0!==s?s:"",placeholder:"Zone",disabled:!et,title:et?void 0:"Admin only",onChange:a=>{let s=a.target.value;v(a=>a?{...a,channels:a.channels.map(a=>a.id===e.id?{...a,zone:s}:a)}:a)},onBlur:()=>{var a;return eD(e.id,null!==(a=e.zone)&&void 0!==a?a:"")},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()}})]}),et&&t&&(0,l.jsx)("button",{className:"pill small-pill ghost",onClick:()=>eM(e.id),disabled:ee[e.id],children:ee[e.id]?"Resetting...":"Reset count"}),X[e.id]&&(0,l.jsx)("span",{className:"pill small-pill ghost",children:"Saving"})]}),(0,l.jsx)("div",{className:"mini-grid",children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mini",children:[(0,l.jsx)("h5",{children:"Gender"}),(0,l.jsxs)("div",{className:"value",children:["M ",e.stats.gender.male," \xb7 F ",e.stats.gender.female," \xb7 U"," ",e.stats.gender.unknown]})]}),(0,l.jsxs)("div",{className:"mini",children:[(0,l.jsx)("h5",{children:"Avg age"}),(0,l.jsx)("div",{className:"value",children:ey(e.stats.age.avg)})]}),(0,l.jsxs)("div",{className:"mini",children:[(0,l.jsx)("h5",{children:"Glasses"}),(0,l.jsxs)("div",{className:"value",children:["Yes ",e.stats.glasses.yes," \xb7 No ",e.stats.glasses.no," \xb7 U"," ",e.stats.glasses.unknown]})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mini",children:[(0,l.jsx)("h5",{children:"In"}),(0,l.jsx)("div",{className:"value",children:e.stats.peopleIn})]}),(0,l.jsxs)("div",{className:"mini",children:[(0,l.jsx)("h5",{children:"Out"}),(0,l.jsx)("div",{className:"value",children:e.stats.peopleOut})]}),(0,l.jsxs)("div",{className:"mini",children:[(0,l.jsx)("h5",{children:"Occupancy"}),(0,l.jsx)("div",{className:"value",children:Math.max(0,e.stats.peopleIn-e.stats.peopleOut)})]})]})}),(0,l.jsxs)("div",{className:"small",children:["Last event: ",eN(e.stats.lastEventAt)]})]},e.id)})})]}),(0,l.jsxs)("section",{className:"panel",children:[(0,l.jsxs)("div",{className:"header-min",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"Zone channels"}),(0,l.jsx)("span",{className:"small",children:"Select a zone to view channels across devices"})]}),(0,l.jsxs)("div",{className:"actions",children:[(0,l.jsxs)("select",{value:k,onChange:e=>S(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select zone"}),w.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsx)("button",{className:"pill small-pill ghost",onClick:()=>k&&eE(k),disabled:!k||T,children:T?"Loading...":"Refresh zone"})]})]}),k&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"device-summary",children:[(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"Devices"}),(0,l.jsx)("div",{className:"value",children:ep}),(0,l.jsxs)("span",{className:"small",children:["In ",k]})]}),(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"People in"}),(0,l.jsx)("div",{className:"value",children:eu.peopleIn}),(0,l.jsx)("span",{className:"small",children:"All channels"})]}),(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"People out"}),(0,l.jsx)("div",{className:"value",children:eu.peopleOut}),(0,l.jsx)("span",{className:"small",children:"All channels"})]}),(0,l.jsxs)("div",{className:"summary-card",children:[(0,l.jsx)("h4",{children:"Occupancy"}),(0,l.jsx)("div",{className:"value",children:eu.occupancy}),(0,l.jsx)("span",{className:"small",children:"Net in zone"})]})]}),M&&(0,l.jsx)("div",{className:"pill small-pill danger",children:M}),(0,l.jsx)("div",{className:"camera-grid",children:E.map(e=>{let a=eb(e.cameraName)||eA(e.channelName,e.features,e.capabilities,e.stats);return(0,l.jsxs)("div",{className:"camera-card",children:[(0,l.jsxs)("div",{className:"camera-header",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"camera-name",children:e.channelName}),(0,l.jsxs)("div",{className:"small",children:[e.cameraName||e.cameraIp," \xb7 Channel ",e.channelId]})]}),(0,l.jsx)("span",{className:"pill small-pill ghost",children:k})]}),(0,l.jsx)("div",{className:"pie-grid",children:a?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o,{title:"Gender mix",subtitle:"Attributes",slices:ew(e.stats)}),(0,l.jsx)(o,{title:"Age range",subtitle:"Attributes",slices:eC(e.ageBuckets)})]}):(0,l.jsx)(o,{title:"People flow",subtitle:"In / Out / Occupancy",slices:ek(e.stats)})}),(0,l.jsxs)("div",{className:"small",children:["Last event: ",eN(e.stats.lastEventAt)]})]},"".concat(e.cameraId,"-").concat(e.channelId))})})]})]})]})]}),(0,l.jsxs)("footer",{className:"footer",children:[(0,l.jsx)("span",{className:"small",children:"Powered by"}),(0,l.jsx)(c(),{src:h,alt:"Powered by",width:120,height:50})]})]})}}},function(e){e.O(0,[352,971,938,744],function(){return e(e.s=5807)}),_N_E=e.O()}]);