"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},4226:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>v,patchFetch:()=>k,requestAsyncStorage:()=>f,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>g});var n={};t.r(n),t.d(n,{POST:()=>p});var o=t(5419),s=t(9108),a=t(9678),u=t(8070),i=t(7802),l=t(3205);async function p(e){let r=await e.json().catch(()=>({})),t="string"==typeof r.username?r.username.trim():"",n="string"==typeof r.password?r.password:"";if(!t||!n)return u.Z.json({ok:!1,error:"Missing credentials."},{status:400});let o=(0,i.z)(),s=(await o.query("select username, password_hash, role from users where username = $1",[t])).rows[0];if(!s||!(0,l.Gv)(n,s.password_hash))return u.Z.json({ok:!1,error:"Invalid credentials."},{status:401});let{token:a}=(0,l.ed)(s.username,s.role),p=u.Z.json({ok:!0,user:{username:s.username,role:s.role}});return p.cookies.set({name:(0,l.Zk)(),value:a,httpOnly:!0,sameSite:"lax",secure:!0,path:"/",maxAge:(0,l.YD)()}),p}let c=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/ameralyasin/Desktop/cam analysis/app/api/auth/login/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:d,serverHooks:m,headerHooks:h,staticGenerationBailout:g}=c,v="/api/auth/login/route";function k(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},3205:(e,r,t)=>{t.d(r,{Gv:()=>m,YD:()=>d,Zk:()=>f,ed:()=>p,v6:()=>c});var n=t(6113),o=t.n(n);let s="session",a=()=>process.env.AUTH_SECRET||"dev-secret",u=e=>Buffer.from(e).toString("base64url"),i=e=>Buffer.from(e,"base64url").toString("utf8"),l=e=>o().createHmac("sha256",a()).update(e).digest("base64url");function p(e,r){let t=Date.now()+432e5,n=u(JSON.stringify({username:e,role:r,exp:t}));return{token:`${n}.${l(n)}`,exp:t}}function c(e){var r;return function(e){if(!e)return null;let[r,t]=e.split(".");if(!r||!t||l(r)!==t)return null;try{let e=JSON.parse(i(r));if(!e?.exp||Date.now()>e.exp)return null;return e}catch{return null}}(((r=e.headers.get("cookie"))?r.split(";").reduce((e,r)=>{let[t,...n]=r.trim().split("=");return t&&(e[t]=decodeURIComponent(n.join("="))),e},{}):{})[s])}function f(){return s}function d(){return 43200}function m(e,r){let[t,n,s,a]=r.split("$");if("pbkdf2"!==t||!n||!s||!a)return!1;let u=Number(n);if(!Number.isFinite(u)||u<=0)return!1;let i=o().pbkdf2Sync(e,s,u,32,"sha256").toString("hex");return o().timingSafeEqual(Buffer.from(a,"hex"),Buffer.from(i,"hex"))}},7802:(e,r,t)=>{t.d(r,{z:()=>s});let n=require("pg"),o=null;function s(){if(!o){let e=process.env.DATABASE_URL;if(!e)throw Error("DATABASE_URL is not set.");o=new n.Pool({connectionString:e})}return o}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[638,206],()=>t(4226));module.exports=n})();