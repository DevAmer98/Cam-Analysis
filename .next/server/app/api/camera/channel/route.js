"use strict";(()=>{var e={};e.id=984,e.ids=[984],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},134:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>c,serverHooks:()=>d,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>g});var n={};t.r(n),t.d(n,{PATCH:()=>p});var o=t(5419),a=t(9108),i=t(9678),u=t(8070),s=t(7802),l=t(3205);async function p(e){let r=(0,l.v6)(e);if(!r||"admin"!==r.role)return u.Z.json({ok:!1,error:"Forbidden."},{status:403});let t=await e.json().catch(()=>({})),n="string"==typeof t.ip?t.ip.trim():"",o="string"==typeof t.channelId?t.channelId.trim():"",a=Object.prototype.hasOwnProperty.call(t,"name"),i=Object.prototype.hasOwnProperty.call(t,"zone"),p="string"==typeof t.name?t.name.trim():t.name??"",c="string"==typeof t.zone?t.zone.trim():t.zone??"";if(!n||!o)return u.Z.json({ok:!1,error:"Missing ip or channelId."},{status:400});let f=(0,s.z)(),h=await f.query("select id from cameras where ip = $1",[n]),d=h.rows[0]?.id;if(!d)return u.Z.json({ok:!1,error:"Camera not found."},{status:404});if(!a&&!i)return u.Z.json({ok:!1,error:"Missing name or zone."},{status:400});let m=[],g=[];if(a){let e=p.length?p:null;m.push(`name = $${g.length+1}`),g.push(e)}if(i){let e=c.length?c:null;m.push(`zone = $${g.length+1}`),g.push(e)}m.push("updated_at = now()"),g.push(d,String(Number(o)));let y=await f.query(`update channels
     set ${m.join(", ")}
     where camera_id = $${g.length-1} and channel_no = $${g.length}
     returning name, zone`,g);return 0===y.rowCount?u.Z.json({ok:!1,error:"Channel not found."},{status:404}):u.Z.json({ok:!0,name:y.rows[0]?.name??null,zone:y.rows[0]?.zone??null})}let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/camera/channel/route",pathname:"/api/camera/channel",filename:"route",bundlePath:"app/api/camera/channel/route"},resolvedPagePath:"/Users/ameralyasin/Desktop/cam analysis/app/api/camera/channel/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:d,headerHooks:m,staticGenerationBailout:g}=c,y="/api/camera/channel/route";function w(){return(0,i.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:h})}},3205:(e,r,t)=>{t.d(r,{Gv:()=>d,YD:()=>h,Zk:()=>f,ed:()=>p,v6:()=>c});var n=t(6113),o=t.n(n);let a="session",i=()=>process.env.AUTH_SECRET||"dev-secret",u=e=>Buffer.from(e).toString("base64url"),s=e=>Buffer.from(e,"base64url").toString("utf8"),l=e=>o().createHmac("sha256",i()).update(e).digest("base64url");function p(e,r){let t=Date.now()+432e5,n=u(JSON.stringify({username:e,role:r,exp:t}));return{token:`${n}.${l(n)}`,exp:t}}function c(e){var r;return function(e){if(!e)return null;let[r,t]=e.split(".");if(!r||!t||l(r)!==t)return null;try{let e=JSON.parse(s(r));if(!e?.exp||Date.now()>e.exp)return null;return e}catch{return null}}(((r=e.headers.get("cookie"))?r.split(";").reduce((e,r)=>{let[t,...n]=r.trim().split("=");return t&&(e[t]=decodeURIComponent(n.join("="))),e},{}):{})[a])}function f(){return a}function h(){return 43200}function d(e,r){let[t,n,a,i]=r.split("$");if("pbkdf2"!==t||!n||!a||!i)return!1;let u=Number(n);if(!Number.isFinite(u)||u<=0)return!1;let s=o().pbkdf2Sync(e,a,u,32,"sha256").toString("hex");return o().timingSafeEqual(Buffer.from(i,"hex"),Buffer.from(s,"hex"))}},7802:(e,r,t)=>{t.d(r,{z:()=>a});let n=require("pg"),o=null;function a(){if(!o){let e=process.env.DATABASE_URL;if(!e)throw Error("DATABASE_URL is not set.");o=new n.Pool({connectionString:e})}return o}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[638,206],()=>t(134));module.exports=n})();