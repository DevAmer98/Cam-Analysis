"use strict";(()=>{var e={};e.id=102,e.ids=[102],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7748:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>b,originalPathname:()=>f,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>k});var a={};r.r(a),r.d(a,{GET:()=>c});var s=r(5419),o=r(9108),i=r(9678),u=r(8070),n=r(7802);async function c(e){let t=new URL(e.url),r=t.searchParams.get("ip"),a=Number(t.searchParams.get("hours")??"24"),s=t.searchParams.get("day"),o=s?s.trim():"";if(!r)return u.Z.json({ok:!1,error:"Missing ip."},{status:400});let i=(0,n.z)(),c=await i.query("select id from cameras where ip = $1",[r]),l=c.rows[0]?.id;if(!l)return u.Z.json({ok:!0,series:[]});let p=Number.isFinite(a)&&a>0?Math.min(a,168):24,m=o?[l,o]:[l,String(p)],d=await i.query(`select bucket_start as bucket,
            coalesce(sum(in_count), 0) as people_in,
            coalesce(sum(out_count), 0) as people_out
     from counting_stats_hourly
     where ${o?"camera_id = $1 and bucket_start >= $2::date and bucket_start < $2::date + interval '1 day'":"camera_id = $1 and bucket_start >= now() - ($2::int * interval '1 hour')"}
     group by bucket
     order by bucket`,m),b=o?[l,o]:[l,String(p)],k=await i.query(`select bucket_start as bucket,
            coalesce(sum(total), 0) as faces
     from face_stats_hourly
     where ${o?"camera_id = $1 and bucket_start >= $2::date and bucket_start < $2::date + interval '1 day'":"camera_id = $1 and bucket_start >= now() - ($2::int * interval '1 hour')"}
     group by bucket
     order by bucket`,b),f=new Map;for(let e of d.rows){let t=e.bucket?new Date(e.bucket).toISOString():null;t&&f.set(t,{t:t,peopleIn:Number(e.people_in??0),peopleOut:Number(e.people_out??0),faces:0})}for(let e of k.rows){let t=e.bucket?new Date(e.bucket).toISOString():null;if(!t)continue;let r=f.get(t)??{t:t,peopleIn:0,peopleOut:0,faces:0};r.faces=Number(e.faces??0),f.set(t,r)}return u.Z.json({ok:!0,series:Array.from(f.values()).sort((e,t)=>e.t.localeCompare(t.t))})}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/camera/timeseries/route",pathname:"/api/camera/timeseries",filename:"route",bundlePath:"app/api/camera/timeseries/route"},resolvedPagePath:"/Users/ameralyasin/Desktop/cam analysis/app/api/camera/timeseries/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:d,headerHooks:b,staticGenerationBailout:k}=l,f="/api/camera/timeseries/route";function _(){return(0,i.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:m})}},7802:(e,t,r)=>{r.d(t,{z:()=>o});let a=require("pg"),s=null;function o(){if(!s){let e=process.env.DATABASE_URL;if(!e)throw Error("DATABASE_URL is not set.");s=new a.Pool({connectionString:e})}return s}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206],()=>r(7748));module.exports=a})();