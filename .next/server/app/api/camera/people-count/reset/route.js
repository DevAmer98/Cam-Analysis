"use strict";(()=>{var e={};e.id=230,e.ids=[230],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},1798:(e,t,n)=>{n.r(t),n.d(t,{headerHooks:()=>v,originalPathname:()=>A,patchFetch:()=>E,requestAsyncStorage:()=>d,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var r={};n.r(r),n.d(r,{POST:()=>p});var a=n(5419),o=n(9108),s=n(9678),u=n(8070),l=n(7802),i=n(3205),c=n(970);async function p(e){let t=(0,i.v6)(e);if(!t||"admin"!==t.role)return u.Z.json({ok:!1,error:"Forbidden."},{status:403});let n=await e.json().catch(()=>({})),r="string"==typeof n.ip?n.ip.trim():"",a="string"==typeof n.channelId?n.channelId.trim():"";if(!r||!a)return u.Z.json({ok:!1,error:"Missing ip or channelId."},{status:400});let o=(0,l.z)(),s=await o.query("select id from cameras where ip = $1",[r]),p=s.rows[0]?.id;return p?(await o.query(`delete from counting_stats_daily
     where camera_id = $1 and channel_no = $2`,[p,Number(a)]),await o.query(`delete from counting_stats_hourly
     where camera_id = $1 and channel_no = $2`,[p,Number(a)]),(0,c.sS)(r,a),u.Z.json({ok:!0})):u.Z.json({ok:!1,error:"Camera not found."},{status:404})}let f=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/camera/people-count/reset/route",pathname:"/api/camera/people-count/reset",filename:"route",bundlePath:"app/api/camera/people-count/reset/route"},resolvedPagePath:"/Users/ameralyasin/Desktop/cam analysis/app/api/camera/people-count/reset/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:v,staticGenerationBailout:g}=f,A="/api/camera/people-count/reset/route";function E(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},3205:(e,t,n)=>{n.d(t,{Gv:()=>m,YD:()=>d,Zk:()=>f,ed:()=>c,v6:()=>p});var r=n(6113),a=n.n(r);let o="session",s=()=>process.env.AUTH_SECRET||"dev-secret",u=e=>Buffer.from(e).toString("base64url"),l=e=>Buffer.from(e,"base64url").toString("utf8"),i=e=>a().createHmac("sha256",s()).update(e).digest("base64url");function c(e,t){let n=Date.now()+432e5,r=u(JSON.stringify({username:e,role:t,exp:n}));return{token:`${r}.${i(r)}`,exp:n}}function p(e){var t;return function(e){if(!e)return null;let[t,n]=e.split(".");if(!t||!n||i(t)!==n)return null;try{let e=JSON.parse(l(t));if(!e?.exp||Date.now()>e.exp)return null;return e}catch{return null}}(((t=e.headers.get("cookie"))?t.split(";").reduce((e,t)=>{let[n,...r]=t.trim().split("=");return n&&(e[n]=decodeURIComponent(r.join("="))),e},{}):{})[o])}function f(){return o}function d(){return 43200}function m(e,t){let[n,r,o,s]=t.split("$");if("pbkdf2"!==n||!r||!o||!s)return!1;let u=Number(r);if(!Number.isFinite(u)||u<=0)return!1;let l=a().pbkdf2Sync(e,o,u,32,"sha256").toString("hex");return a().timingSafeEqual(Buffer.from(s,"hex"),Buffer.from(l,"hex"))}},970:(e,t,n)=>{n.d(t,{B$:()=>i,KX:()=>u,Lb:()=>s,sS:()=>l,yo:()=>c});let r=new Map,a=()=>({peopleIn:0,peopleOut:0,faceEvents:0,facesDetected:0,gender:{male:0,female:0,unknown:0},age:{avg:null},glasses:{yes:0,no:0,unknown:0},lastEventAt:null});function o(e){return r.has(e)||r.set(e,{channels:{},lastEventAt:null}),r.get(e)}function s(e,t){let n=o(e);return n.channels[t]||(n.channels[t]=a()),n.channels[t]}function u(e){let{ip:t,channelId:n,objectIn:r,objectOut:a,timestamp:u}=e,l=s(t,n);l.peopleIn+=r,l.peopleOut+=a,l.lastEventAt=u??new Date().toISOString(),o(t).lastEventAt=l.lastEventAt}function l(e,t){let n=s(e,t);n.peopleIn=0,n.peopleOut=0,n.lastEventAt=null}function i(e){let{ip:t,channelId:n,facesDetected:r,timestamp:a}=e,u=s(t,n);u.faceEvents+=1,u.facesDetected+=r,u.lastEventAt=a??new Date().toISOString(),o(t).lastEventAt=u.lastEventAt}function c(e){let t=o(e);return{ip:e,lastEventAt:t.lastEventAt,channels:Object.entries(t.channels).map(([e,t])=>({channelId:e,stats:t}))}}},7802:(e,t,n)=>{n.d(t,{z:()=>o});let r=require("pg"),a=null;function o(){if(!a){let e=process.env.DATABASE_URL;if(!e)throw Error("DATABASE_URL is not set.");a=new r.Pool({connectionString:e})}return a}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[638,206],()=>n(1798));module.exports=r})();