"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/report/download/route";
exports.ids = ["app/api/report/download/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("pg");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Freport%2Fdownload%2Froute&page=%2Fapi%2Freport%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freport%2Fdownload%2Froute.ts&appDir=%2FUsers%2Fameralyasin%2FDesktop%2Fcam%20analysis%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fameralyasin%2FDesktop%2Fcam%20analysis&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Freport%2Fdownload%2Froute&page=%2Fapi%2Freport%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freport%2Fdownload%2Froute.ts&appDir=%2FUsers%2Fameralyasin%2FDesktop%2Fcam%20analysis%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fameralyasin%2FDesktop%2Fcam%20analysis&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_ameralyasin_Desktop_cam_analysis_app_api_report_download_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/report/download/route.ts */ \"(rsc)/./app/api/report/download/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/report/download/route\",\n        pathname: \"/api/report/download\",\n        filename: \"route\",\n        bundlePath: \"app/api/report/download/route\"\n    },\n    resolvedPagePath: \"/Users/ameralyasin/Desktop/cam analysis/app/api/report/download/route.ts\",\n    nextConfigOutput,\n    userland: _Users_ameralyasin_Desktop_cam_analysis_app_api_report_download_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/report/download/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZyZXBvcnQlMkZkb3dubG9hZCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGcmVwb3J0JTJGZG93bmxvYWQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZyZXBvcnQlMkZkb3dubG9hZCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmFtZXJhbHlhc2luJTJGRGVza3RvcCUyRmNhbSUyMGFuYWx5c2lzJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmFtZXJhbHlhc2luJTJGRGVza3RvcCUyRmNhbSUyMGFuYWx5c2lzJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3dCO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdUdBQXVHO0FBQy9HO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDNko7O0FBRTdKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FtLWFuYWx5c2lzLz80NWFkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9hbWVyYWx5YXNpbi9EZXNrdG9wL2NhbSBhbmFseXNpcy9hcHAvYXBpL3JlcG9ydC9kb3dubG9hZC9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcmVwb3J0L2Rvd25sb2FkL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcmVwb3J0L2Rvd25sb2FkXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9yZXBvcnQvZG93bmxvYWQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvYW1lcmFseWFzaW4vRGVza3RvcC9jYW0gYW5hbHlzaXMvYXBwL2FwaS9yZXBvcnQvZG93bmxvYWQvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0IH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvcmVwb3J0L2Rvd25sb2FkL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Freport%2Fdownload%2Froute&page=%2Fapi%2Freport%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freport%2Fdownload%2Froute.ts&appDir=%2FUsers%2Fameralyasin%2FDesktop%2Fcam%20analysis%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fameralyasin%2FDesktop%2Fcam%20analysis&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/report/download/route.ts":
/*!******************************************!*\
  !*** ./app/api/report/download/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../lib/auth */ \"(rsc)/./lib/auth.ts\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../lib/db */ \"(rsc)/./lib/db.ts\");\n\n\n\nconst csvEscape = (value)=>{\n    const raw = value === null || value === undefined ? \"\" : String(value);\n    if (/[\",\\n]/.test(raw)) return `\"${raw.replace(/\"/g, '\"\"')}\"`;\n    return raw;\n};\nconst row = (values)=>values.map(csvEscape).join(\",\");\nconst htmlEscape = (value)=>String(value ?? \"\").replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\nasync function GET(req) {\n    const session = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.getSessionFromRequest)(req);\n    if (!session) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            ok: false,\n            error: \"Unauthorized.\"\n        }, {\n            status: 401\n        });\n    }\n    if (session.role !== \"admin\") {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            ok: false,\n            error: \"Admin access required.\"\n        }, {\n            status: 403\n        });\n    }\n    const url = new URL(req.url);\n    const day = url.searchParams.get(\"day\")?.trim() || \"\";\n    const requestedZone = url.searchParams.get(\"zone\")?.trim() || \"\";\n    const scope = url.searchParams.get(\"scope\") === \"zone\" ? \"zone\" : \"all\";\n    const format = url.searchParams.get(\"format\") === \"xls\" ? \"xls\" : \"csv\";\n    if (scope === \"zone\" && !requestedZone) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            ok: false,\n            error: \"Please select a zone for zone-scope report.\"\n        }, {\n            status: 400\n        });\n    }\n    const zone = scope === \"zone\" ? requestedZone : \"\";\n    const db = (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.getDbPool)();\n    const peopleWhere = day ? \"day = $1::date\" : \"day >= current_date\";\n    const peopleParams = day ? [\n        day\n    ] : [];\n    const totalsResult = await db.query(`select coalesce(sum(in_count), 0) as people_in,\n            coalesce(sum(out_count), 0) as people_out\n     from counting_stats_daily\n     where ${peopleWhere}`, peopleParams);\n    const faceWhere = day ? \"day = $1::date\" : \"day >= current_date\";\n    const faceParams = day ? [\n        day\n    ] : [];\n    const faceResult = await db.query(`select\n        coalesce(sum(male), 0) as male_count,\n        coalesce(sum(female), 0) as female_count,\n        coalesce(sum(unknown_gender), 0) as unknown_count,\n        coalesce(sum(age_child), 0) as child_count,\n        coalesce(sum(age_teen), 0) as teen_count,\n        coalesce(sum(age_young_adult), 0) as young_count,\n        coalesce(sum(age_middle_age), 0) as middle_count,\n        coalesce(sum(age_senior), 0) as senior_count,\n        coalesce(sum(age_unknown), 0) as age_unknown_count\n     from face_stats_daily\n     where ${faceWhere}`, faceParams);\n    const zoneParams = zone ? [\n        zone,\n        ...day ? [\n            day\n        ] : []\n    ] : day ? [\n        day\n    ] : [];\n    const zoneCondition = zone ? \"ch.zone = $1\" : \"1=1\";\n    const dayCondition = day ? `and p.day = $${zone ? 2 : 1}::date` : \"and p.day >= current_date\";\n    const zonePeopleResult = await db.query(`select coalesce(sum(p.in_count), 0) as people_in,\n            coalesce(sum(p.out_count), 0) as people_out\n     from counting_stats_daily p\n     join channels ch on ch.camera_id = p.camera_id and ch.channel_no = p.channel_no\n     where ${zoneCondition} ${dayCondition}`, zoneParams);\n    const zoneFaceParams = zone ? [\n        zone,\n        ...day ? [\n            day\n        ] : []\n    ] : day ? [\n        day\n    ] : [];\n    const zoneFaceCondition = zone ? \"ch.zone = $1\" : \"1=1\";\n    const zoneFaceDayCondition = day ? `and f.day = $${zone ? 2 : 1}::date` : \"and f.day >= current_date\";\n    const zoneFaceResult = await db.query(`select coalesce(sum(f.total), 0) as faces_total,\n            coalesce(sum(f.male), 0) as male_count,\n            coalesce(sum(f.female), 0) as female_count,\n            coalesce(sum(f.unknown_gender), 0) as unknown_count\n     from face_stats_daily f\n     join channels ch on ch.camera_id = f.camera_id and ch.channel_no = f.channel_no\n     where ${zoneFaceCondition} ${zoneFaceDayCondition}`, zoneFaceParams);\n    const detailsParams = zone ? [\n        zone,\n        ...day ? [\n            day\n        ] : []\n    ] : day ? [\n        day\n    ] : [];\n    const detailsZoneCondition = zone ? \"ch.zone = $1\" : \"1=1\";\n    const detailsDayJoinCondition = day ? `and p.day = $${zone ? 2 : 1}::date` : \"and p.day >= current_date\";\n    const detailsResult = await db.query(`select c.ip,\n            coalesce(c.name, c.ip) as camera_name,\n            ch.channel_no,\n            coalesce(ch.name, concat('Channel ', ch.channel_no::text)) as channel_name,\n            coalesce(sum(p.in_count), 0) as people_in,\n            coalesce(sum(p.out_count), 0) as people_out\n     from channels ch\n     join cameras c on c.id = ch.camera_id\n     left join counting_stats_daily p\n       on p.camera_id = ch.camera_id\n      and p.channel_no = ch.channel_no\n      ${detailsDayJoinCondition}\n     where ${detailsZoneCondition}\n     group by c.ip, c.name, ch.channel_no, ch.name\n     order by coalesce(c.name, c.ip), ch.channel_no`, detailsParams);\n    const totals = totalsResult.rows[0] ?? {};\n    const face = faceResult.rows[0] ?? {};\n    const zonePeople = zonePeopleResult.rows[0] ?? {};\n    const zoneFace = zoneFaceResult.rows[0] ?? {};\n    const lines = [];\n    lines.push(row([\n        \"report_day\",\n        day || \"today\"\n    ]));\n    lines.push(row([\n        \"report_scope\",\n        scope\n    ]));\n    lines.push(row([\n        \"zone_filter\",\n        zone || \"all\"\n    ]));\n    lines.push(\"\");\n    lines.push(row([\n        \"section\",\n        \"metric\",\n        \"value\"\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"people_in\",\n        Number(totals.people_in ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"people_out\",\n        Number(totals.people_out ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"gender_male\",\n        Number(face.male_count ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"gender_female\",\n        Number(face.female_count ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"gender_unknown\",\n        Number(face.unknown_count ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"age_child\",\n        Number(face.child_count ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"age_teen\",\n        Number(face.teen_count ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"age_young_adult\",\n        Number(face.young_count ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"age_middle_age\",\n        Number(face.middle_count ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"age_senior\",\n        Number(face.senior_count ?? 0)\n    ]));\n    lines.push(row([\n        \"all_devices\",\n        \"age_unknown\",\n        Number(face.age_unknown_count ?? 0)\n    ]));\n    lines.push(row([\n        \"zone_scope\",\n        \"people_in\",\n        Number(zonePeople.people_in ?? 0)\n    ]));\n    lines.push(row([\n        \"zone_scope\",\n        \"people_out\",\n        Number(zonePeople.people_out ?? 0)\n    ]));\n    lines.push(row([\n        \"zone_scope\",\n        \"occupancy\",\n        Number(zonePeople.people_in ?? 0) - Number(zonePeople.people_out ?? 0)\n    ]));\n    lines.push(row([\n        \"zone_scope\",\n        \"faces_total\",\n        Number(zoneFace.faces_total ?? 0)\n    ]));\n    lines.push(row([\n        \"zone_scope\",\n        \"gender_male\",\n        Number(zoneFace.male_count ?? 0)\n    ]));\n    lines.push(row([\n        \"zone_scope\",\n        \"gender_female\",\n        Number(zoneFace.female_count ?? 0)\n    ]));\n    lines.push(row([\n        \"zone_scope\",\n        \"gender_unknown\",\n        Number(zoneFace.unknown_count ?? 0)\n    ]));\n    lines.push(\"\");\n    lines.push(row([\n        \"section\",\n        \"camera_ip\",\n        \"camera_name\",\n        \"channel_no\",\n        \"channel_name\",\n        \"people_in\",\n        \"people_out\",\n        \"occupancy\"\n    ]));\n    for (const entry of detailsResult.rows){\n        const inCount = Number(entry.people_in ?? 0);\n        const outCount = Number(entry.people_out ?? 0);\n        lines.push(row([\n            \"channel\",\n            entry.ip,\n            entry.camera_name,\n            Number(entry.channel_no),\n            entry.channel_name,\n            inCount,\n            outCount,\n            Math.max(0, inCount - outCount)\n        ]));\n    }\n    const zonePart = zone ? `-${zone.replace(/\\s+/g, \"_\")}` : \"\";\n    const dayPart = day || new Date().toISOString().slice(0, 10);\n    if (format === \"xls\") {\n        const summaryRows = lines.filter((line)=>line.startsWith(\"all_devices,\") || line.startsWith(\"zone_scope,\")).map((line)=>line.split(\",\"));\n        const detailRows = detailsResult.rows.map((entry)=>{\n            const inCount = Number(entry.people_in ?? 0);\n            const outCount = Number(entry.people_out ?? 0);\n            return [\n                entry.ip,\n                entry.camera_name,\n                Number(entry.channel_no),\n                entry.channel_name,\n                inCount,\n                outCount,\n                Math.max(0, inCount - outCount)\n            ];\n        });\n        const html = `<!doctype html><html><head><meta charset=\"utf-8\" /></head><body>\n      <table border=\"1\">\n        <tr><th>report_day</th><td>${htmlEscape(day || \"today\")}</td></tr>\n        <tr><th>report_scope</th><td>${htmlEscape(scope)}</td></tr>\n        <tr><th>zone_filter</th><td>${htmlEscape(zone || \"all\")}</td></tr>\n      </table>\n      <br />\n      <table border=\"1\">\n        <tr><th>section</th><th>metric</th><th>value</th></tr>\n        ${summaryRows.map((r)=>`<tr><td>${htmlEscape(r[0])}</td><td>${htmlEscape(r[1])}</td><td>${htmlEscape(r[2])}</td></tr>`).join(\"\")}\n      </table>\n      <br />\n      <table border=\"1\">\n        <tr><th>camera_ip</th><th>camera_name</th><th>channel_no</th><th>channel_name</th><th>people_in</th><th>people_out</th><th>occupancy</th></tr>\n        ${detailRows.map((r)=>`<tr><td>${htmlEscape(r[0])}</td><td>${htmlEscape(r[1])}</td><td>${htmlEscape(r[2])}</td><td>${htmlEscape(r[3])}</td><td>${htmlEscape(r[4])}</td><td>${htmlEscape(r[5])}</td><td>${htmlEscape(r[6])}</td></tr>`).join(\"\")}\n      </table>\n    </body></html>`;\n        const filename = `camera-report-${dayPart}${zonePart}.xls`;\n        return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](html, {\n            status: 200,\n            headers: {\n                \"Content-Type\": \"application/vnd.ms-excel; charset=utf-8\",\n                \"Content-Disposition\": `attachment; filename=\\\"${filename}\\\"`\n            }\n        });\n    }\n    const filename = `camera-report-${dayPart}${zonePart}.csv`;\n    return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](lines.join(\"\\n\"), {\n        status: 200,\n        headers: {\n            \"Content-Type\": \"text/csv; charset=utf-8\",\n            \"Content-Disposition\": `attachment; filename=\\\"${filename}\\\"`\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3JlcG9ydC9kb3dubG9hZC9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTJDO0FBQ2tCO0FBQ2Q7QUFFL0MsTUFBTUcsWUFBWSxDQUFDQztJQUNqQixNQUFNQyxNQUFNRCxVQUFVLFFBQVFBLFVBQVVFLFlBQVksS0FBS0MsT0FBT0g7SUFDaEUsSUFBSSxTQUFTSSxJQUFJLENBQUNILE1BQU0sT0FBTyxDQUFDLENBQUMsRUFBRUEsSUFBSUksT0FBTyxDQUFDLE1BQU0sTUFBUSxDQUFDLENBQUM7SUFDL0QsT0FBT0o7QUFDVDtBQUVBLE1BQU1LLE1BQU0sQ0FBQ0MsU0FBc0JBLE9BQU9DLEdBQUcsQ0FBQ1QsV0FBV1UsSUFBSSxDQUFDO0FBQzlELE1BQU1DLGFBQWEsQ0FBQ1YsUUFDbEJHLE9BQU9ILFNBQVMsSUFDYkssT0FBTyxDQUFDLE1BQU0sU0FDZEEsT0FBTyxDQUFDLE1BQU0sUUFDZEEsT0FBTyxDQUFDLE1BQU07QUFFWixlQUFlTSxJQUFJQyxHQUFZO0lBQ3BDLE1BQU1DLFVBQVVoQixnRUFBcUJBLENBQUNlO0lBQ3RDLElBQUksQ0FBQ0MsU0FBUztRQUNaLE9BQU9qQixrRkFBWUEsQ0FBQ2tCLElBQUksQ0FBQztZQUFFQyxJQUFJO1lBQU9DLE9BQU87UUFBZ0IsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDaEY7SUFDQSxJQUFJSixRQUFRSyxJQUFJLEtBQUssU0FBUztRQUM1QixPQUFPdEIsa0ZBQVlBLENBQUNrQixJQUFJLENBQUM7WUFBRUMsSUFBSTtZQUFPQyxPQUFPO1FBQXlCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3pGO0lBRUEsTUFBTUUsTUFBTSxJQUFJQyxJQUFJUixJQUFJTyxHQUFHO0lBQzNCLE1BQU1FLE1BQU1GLElBQUlHLFlBQVksQ0FBQ0MsR0FBRyxDQUFDLFFBQVFDLFVBQVU7SUFDbkQsTUFBTUMsZ0JBQWdCTixJQUFJRyxZQUFZLENBQUNDLEdBQUcsQ0FBQyxTQUFTQyxVQUFVO0lBQzlELE1BQU1FLFFBQVFQLElBQUlHLFlBQVksQ0FBQ0MsR0FBRyxDQUFDLGFBQWEsU0FBUyxTQUFTO0lBQ2xFLE1BQU1JLFNBQVNSLElBQUlHLFlBQVksQ0FBQ0MsR0FBRyxDQUFDLGNBQWMsUUFBUSxRQUFRO0lBQ2xFLElBQUlHLFVBQVUsVUFBVSxDQUFDRCxlQUFlO1FBQ3RDLE9BQU83QixrRkFBWUEsQ0FBQ2tCLElBQUksQ0FDdEI7WUFBRUMsSUFBSTtZQUFPQyxPQUFPO1FBQThDLEdBQ2xFO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtJQUNBLE1BQU1XLE9BQU9GLFVBQVUsU0FBU0QsZ0JBQWdCO0lBQ2hELE1BQU1JLEtBQUsvQixrREFBU0E7SUFFcEIsTUFBTWdDLGNBQWNULE1BQU0sbUJBQW1CO0lBQzdDLE1BQU1VLGVBQWVWLE1BQU07UUFBQ0E7S0FBSSxHQUFHLEVBQUU7SUFDckMsTUFBTVcsZUFBZSxNQUFNSCxHQUFHSSxLQUFLLENBQ2pDLENBQUM7OztXQUdNLEVBQUVILFlBQVksQ0FBQyxFQUN0QkM7SUFHRixNQUFNRyxZQUFZYixNQUFNLG1CQUFtQjtJQUMzQyxNQUFNYyxhQUFhZCxNQUFNO1FBQUNBO0tBQUksR0FBRyxFQUFFO0lBQ25DLE1BQU1lLGFBQWEsTUFBTVAsR0FBR0ksS0FBSyxDQUMvQixDQUFDOzs7Ozs7Ozs7OztXQVdNLEVBQUVDLFVBQVUsQ0FBQyxFQUNwQkM7SUFHRixNQUFNRSxhQUFhVCxPQUFPO1FBQUNBO1dBQVVQLE1BQU07WUFBQ0E7U0FBSSxHQUFHLEVBQUU7S0FBRSxHQUFHQSxNQUFNO1FBQUNBO0tBQUksR0FBRyxFQUFFO0lBQzFFLE1BQU1pQixnQkFBZ0JWLE9BQU8saUJBQWlCO0lBQzlDLE1BQU1XLGVBQWVsQixNQUFNLENBQUMsYUFBYSxFQUFFTyxPQUFPLElBQUksRUFBRSxNQUFNLENBQUMsR0FBRztJQUNsRSxNQUFNWSxtQkFBbUIsTUFBTVgsR0FBR0ksS0FBSyxDQUNyQyxDQUFDOzs7O1dBSU0sRUFBRUssY0FBYyxDQUFDLEVBQUVDLGFBQWEsQ0FBQyxFQUN4Q0Y7SUFHRixNQUFNSSxpQkFBaUJiLE9BQU87UUFBQ0E7V0FBVVAsTUFBTTtZQUFDQTtTQUFJLEdBQUcsRUFBRTtLQUFFLEdBQUdBLE1BQU07UUFBQ0E7S0FBSSxHQUFHLEVBQUU7SUFDOUUsTUFBTXFCLG9CQUFvQmQsT0FBTyxpQkFBaUI7SUFDbEQsTUFBTWUsdUJBQ0p0QixNQUNJLENBQUMsYUFBYSxFQUFFTyxPQUFPLElBQUksRUFBRSxNQUFNLENBQUMsR0FDcEM7SUFDTixNQUFNZ0IsaUJBQWlCLE1BQU1mLEdBQUdJLEtBQUssQ0FDbkMsQ0FBQzs7Ozs7O1dBTU0sRUFBRVMsa0JBQWtCLENBQUMsRUFBRUMscUJBQXFCLENBQUMsRUFDcERGO0lBR0YsTUFBTUksZ0JBQWdCakIsT0FBTztRQUFDQTtXQUFVUCxNQUFNO1lBQUNBO1NBQUksR0FBRyxFQUFFO0tBQUUsR0FBR0EsTUFBTTtRQUFDQTtLQUFJLEdBQUcsRUFBRTtJQUM3RSxNQUFNeUIsdUJBQXVCbEIsT0FBTyxpQkFBaUI7SUFDckQsTUFBTW1CLDBCQUNKMUIsTUFBTSxDQUFDLGFBQWEsRUFBRU8sT0FBTyxJQUFJLEVBQUUsTUFBTSxDQUFDLEdBQUc7SUFDL0MsTUFBTW9CLGdCQUFnQixNQUFNbkIsR0FBR0ksS0FBSyxDQUNsQyxDQUFDOzs7Ozs7Ozs7OztNQVdDLEVBQUVjLHdCQUF3QjtXQUNyQixFQUFFRCxxQkFBcUI7O21EQUVpQixDQUFDLEVBQ2hERDtJQUdGLE1BQU1JLFNBQVNqQixhQUFha0IsSUFBSSxDQUFDLEVBQUUsSUFBSSxDQUFDO0lBQ3hDLE1BQU1DLE9BQU9mLFdBQVdjLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQztJQUNwQyxNQUFNRSxhQUFhWixpQkFBaUJVLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQztJQUNoRCxNQUFNRyxXQUFXVCxlQUFlTSxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUM7SUFFNUMsTUFBTUksUUFBa0IsRUFBRTtJQUMxQkEsTUFBTUMsSUFBSSxDQUFDakQsSUFBSTtRQUFDO1FBQWNlLE9BQU87S0FBUTtJQUM3Q2lDLE1BQU1DLElBQUksQ0FBQ2pELElBQUk7UUFBQztRQUFnQm9CO0tBQU07SUFDdEM0QixNQUFNQyxJQUFJLENBQUNqRCxJQUFJO1FBQUM7UUFBZXNCLFFBQVE7S0FBTTtJQUM3QzBCLE1BQU1DLElBQUksQ0FBQztJQUNYRCxNQUFNQyxJQUFJLENBQUNqRCxJQUFJO1FBQUM7UUFBVztRQUFVO0tBQVE7SUFDN0NnRCxNQUFNQyxJQUFJLENBQUNqRCxJQUFJO1FBQUM7UUFBZTtRQUFha0QsT0FBT1AsT0FBT1EsU0FBUyxJQUFJO0tBQUc7SUFDMUVILE1BQU1DLElBQUksQ0FBQ2pELElBQUk7UUFBQztRQUFlO1FBQWNrRCxPQUFPUCxPQUFPUyxVQUFVLElBQUk7S0FBRztJQUM1RUosTUFBTUMsSUFBSSxDQUFDakQsSUFBSTtRQUFDO1FBQWU7UUFBZWtELE9BQU9MLEtBQUtRLFVBQVUsSUFBSTtLQUFHO0lBQzNFTCxNQUFNQyxJQUFJLENBQUNqRCxJQUFJO1FBQUM7UUFBZTtRQUFpQmtELE9BQU9MLEtBQUtTLFlBQVksSUFBSTtLQUFHO0lBQy9FTixNQUFNQyxJQUFJLENBQUNqRCxJQUFJO1FBQUM7UUFBZTtRQUFrQmtELE9BQU9MLEtBQUtVLGFBQWEsSUFBSTtLQUFHO0lBQ2pGUCxNQUFNQyxJQUFJLENBQUNqRCxJQUFJO1FBQUM7UUFBZTtRQUFha0QsT0FBT0wsS0FBS1csV0FBVyxJQUFJO0tBQUc7SUFDMUVSLE1BQU1DLElBQUksQ0FBQ2pELElBQUk7UUFBQztRQUFlO1FBQVlrRCxPQUFPTCxLQUFLWSxVQUFVLElBQUk7S0FBRztJQUN4RVQsTUFBTUMsSUFBSSxDQUFDakQsSUFBSTtRQUFDO1FBQWU7UUFBbUJrRCxPQUFPTCxLQUFLYSxXQUFXLElBQUk7S0FBRztJQUNoRlYsTUFBTUMsSUFBSSxDQUFDakQsSUFBSTtRQUFDO1FBQWU7UUFBa0JrRCxPQUFPTCxLQUFLYyxZQUFZLElBQUk7S0FBRztJQUNoRlgsTUFBTUMsSUFBSSxDQUFDakQsSUFBSTtRQUFDO1FBQWU7UUFBY2tELE9BQU9MLEtBQUtlLFlBQVksSUFBSTtLQUFHO0lBQzVFWixNQUFNQyxJQUFJLENBQUNqRCxJQUFJO1FBQUM7UUFBZTtRQUFla0QsT0FBT0wsS0FBS2dCLGlCQUFpQixJQUFJO0tBQUc7SUFDbEZiLE1BQU1DLElBQUksQ0FBQ2pELElBQUk7UUFBQztRQUFjO1FBQWFrRCxPQUFPSixXQUFXSyxTQUFTLElBQUk7S0FBRztJQUM3RUgsTUFBTUMsSUFBSSxDQUFDakQsSUFBSTtRQUFDO1FBQWM7UUFBY2tELE9BQU9KLFdBQVdNLFVBQVUsSUFBSTtLQUFHO0lBQy9FSixNQUFNQyxJQUFJLENBQUNqRCxJQUFJO1FBQUM7UUFBYztRQUFha0QsT0FBT0osV0FBV0ssU0FBUyxJQUFJLEtBQUtELE9BQU9KLFdBQVdNLFVBQVUsSUFBSTtLQUFHO0lBQ2xISixNQUFNQyxJQUFJLENBQUNqRCxJQUFJO1FBQUM7UUFBYztRQUFla0QsT0FBT0gsU0FBU2UsV0FBVyxJQUFJO0tBQUc7SUFDL0VkLE1BQU1DLElBQUksQ0FBQ2pELElBQUk7UUFBQztRQUFjO1FBQWVrRCxPQUFPSCxTQUFTTSxVQUFVLElBQUk7S0FBRztJQUM5RUwsTUFBTUMsSUFBSSxDQUFDakQsSUFBSTtRQUFDO1FBQWM7UUFBaUJrRCxPQUFPSCxTQUFTTyxZQUFZLElBQUk7S0FBRztJQUNsRk4sTUFBTUMsSUFBSSxDQUFDakQsSUFBSTtRQUFDO1FBQWM7UUFBa0JrRCxPQUFPSCxTQUFTUSxhQUFhLElBQUk7S0FBRztJQUNwRlAsTUFBTUMsSUFBSSxDQUFDO0lBQ1hELE1BQU1DLElBQUksQ0FBQ2pELElBQUk7UUFBQztRQUFXO1FBQWE7UUFBZTtRQUFjO1FBQWdCO1FBQWE7UUFBYztLQUFZO0lBQzVILEtBQUssTUFBTStELFNBQVNyQixjQUFjRSxJQUFJLENBQUU7UUFDdEMsTUFBTW9CLFVBQVVkLE9BQU9hLE1BQU1aLFNBQVMsSUFBSTtRQUMxQyxNQUFNYyxXQUFXZixPQUFPYSxNQUFNWCxVQUFVLElBQUk7UUFDNUNKLE1BQU1DLElBQUksQ0FDUmpELElBQUk7WUFDRjtZQUNBK0QsTUFBTUcsRUFBRTtZQUNSSCxNQUFNSSxXQUFXO1lBQ2pCakIsT0FBT2EsTUFBTUssVUFBVTtZQUN2QkwsTUFBTU0sWUFBWTtZQUNsQkw7WUFDQUM7WUFDQUssS0FBS0MsR0FBRyxDQUFDLEdBQUdQLFVBQVVDO1NBQ3ZCO0lBRUw7SUFFQSxNQUFNTyxXQUFXbEQsT0FBTyxDQUFDLENBQUMsRUFBRUEsS0FBS3ZCLE9BQU8sQ0FBQyxRQUFRLEtBQUssQ0FBQyxHQUFHO0lBQzFELE1BQU0wRSxVQUFVMUQsT0FBTyxJQUFJMkQsT0FBT0MsV0FBVyxHQUFHQyxLQUFLLENBQUMsR0FBRztJQUN6RCxJQUFJdkQsV0FBVyxPQUFPO1FBQ3BCLE1BQU13RCxjQUFjN0IsTUFDakI4QixNQUFNLENBQUMsQ0FBQ0MsT0FBU0EsS0FBS0MsVUFBVSxDQUFDLG1CQUFtQkQsS0FBS0MsVUFBVSxDQUFDLGdCQUNwRTlFLEdBQUcsQ0FBQyxDQUFDNkUsT0FBU0EsS0FBS0UsS0FBSyxDQUFDO1FBQzVCLE1BQU1DLGFBQWF4QyxjQUFjRSxJQUFJLENBQUMxQyxHQUFHLENBQUMsQ0FBQzZEO1lBQ3pDLE1BQU1DLFVBQVVkLE9BQU9hLE1BQU1aLFNBQVMsSUFBSTtZQUMxQyxNQUFNYyxXQUFXZixPQUFPYSxNQUFNWCxVQUFVLElBQUk7WUFDNUMsT0FBTztnQkFDTFcsTUFBTUcsRUFBRTtnQkFDUkgsTUFBTUksV0FBVztnQkFDakJqQixPQUFPYSxNQUFNSyxVQUFVO2dCQUN2QkwsTUFBTU0sWUFBWTtnQkFDbEJMO2dCQUNBQztnQkFDQUssS0FBS0MsR0FBRyxDQUFDLEdBQUdQLFVBQVVDO2FBQ3ZCO1FBQ0g7UUFDQSxNQUFNa0IsT0FBTyxDQUFDOzttQ0FFaUIsRUFBRS9FLFdBQVdXLE9BQU8sU0FBUztxQ0FDM0IsRUFBRVgsV0FBV2dCLE9BQU87b0NBQ3JCLEVBQUVoQixXQUFXa0IsUUFBUSxPQUFPOzs7OztRQUt4RCxFQUFFdUQsWUFDQzNFLEdBQUcsQ0FDRixDQUFDa0YsSUFDQyxDQUFDLFFBQVEsRUFBRWhGLFdBQVdnRixDQUFDLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRWhGLFdBQVdnRixDQUFDLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRWhGLFdBQVdnRixDQUFDLENBQUMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxFQUVsR2pGLElBQUksQ0FBQyxJQUFJOzs7OztRQUtaLEVBQUUrRSxXQUNDaEYsR0FBRyxDQUNGLENBQUNrRixJQUNDLENBQUMsUUFBUSxFQUFFaEYsV0FBV2dGLENBQUMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFaEYsV0FBV2dGLENBQUMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFaEYsV0FBV2dGLENBQUMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFaEYsV0FBV2dGLENBQUMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFaEYsV0FBV2dGLENBQUMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFaEYsV0FBV2dGLENBQUMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFaEYsV0FBV2dGLENBQUMsQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLEVBRWxOakYsSUFBSSxDQUFDLElBQUk7O2tCQUVGLENBQUM7UUFDZixNQUFNa0YsV0FBVyxDQUFDLGNBQWMsRUFBRVosUUFBUSxFQUFFRCxTQUFTLElBQUksQ0FBQztRQUMxRCxPQUFPLElBQUlsRixrRkFBWUEsQ0FBQzZGLE1BQU07WUFDNUJ4RSxRQUFRO1lBQ1IyRSxTQUFTO2dCQUNQLGdCQUFnQjtnQkFDaEIsdUJBQXVCLENBQUMsdUJBQXVCLEVBQUVELFNBQVMsRUFBRSxDQUFDO1lBQy9EO1FBQ0Y7SUFDRjtJQUVBLE1BQU1BLFdBQVcsQ0FBQyxjQUFjLEVBQUVaLFFBQVEsRUFBRUQsU0FBUyxJQUFJLENBQUM7SUFDMUQsT0FBTyxJQUFJbEYsa0ZBQVlBLENBQUMwRCxNQUFNN0MsSUFBSSxDQUFDLE9BQU87UUFDeENRLFFBQVE7UUFDUjJFLFNBQVM7WUFDUCxnQkFBZ0I7WUFDaEIsdUJBQXVCLENBQUMsdUJBQXVCLEVBQUVELFNBQVMsRUFBRSxDQUFDO1FBQy9EO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2NhbS1hbmFseXNpcy8uL2FwcC9hcGkvcmVwb3J0L2Rvd25sb2FkL3JvdXRlLnRzP2FhMTIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5pbXBvcnQgeyBnZXRTZXNzaW9uRnJvbVJlcXVlc3QgfSBmcm9tIFwiLi4vLi4vLi4vLi4vbGliL2F1dGhcIjtcbmltcG9ydCB7IGdldERiUG9vbCB9IGZyb20gXCIuLi8uLi8uLi8uLi9saWIvZGJcIjtcblxuY29uc3QgY3N2RXNjYXBlID0gKHZhbHVlOiB1bmtub3duKSA9PiB7XG4gIGNvbnN0IHJhdyA9IHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgPyBcIlwiIDogU3RyaW5nKHZhbHVlKTtcbiAgaWYgKC9bXCIsXFxuXS8udGVzdChyYXcpKSByZXR1cm4gYFwiJHtyYXcucmVwbGFjZSgvXCIvZywgXCJcXFwiXFxcIlwiKX1cImA7XG4gIHJldHVybiByYXc7XG59O1xuXG5jb25zdCByb3cgPSAodmFsdWVzOiB1bmtub3duW10pID0+IHZhbHVlcy5tYXAoY3N2RXNjYXBlKS5qb2luKFwiLFwiKTtcbmNvbnN0IGh0bWxFc2NhcGUgPSAodmFsdWU6IHVua25vd24pID0+XG4gIFN0cmluZyh2YWx1ZSA/PyBcIlwiKVxuICAgIC5yZXBsYWNlKC8mL2csIFwiJmFtcDtcIilcbiAgICAucmVwbGFjZSgvPC9nLCBcIiZsdDtcIilcbiAgICAucmVwbGFjZSgvPi9nLCBcIiZndDtcIik7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxOiBSZXF1ZXN0KSB7XG4gIGNvbnN0IHNlc3Npb24gPSBnZXRTZXNzaW9uRnJvbVJlcXVlc3QocmVxKTtcbiAgaWYgKCFzZXNzaW9uKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWQuXCIgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgfVxuICBpZiAoc2Vzc2lvbi5yb2xlICE9PSBcImFkbWluXCIpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBvazogZmFsc2UsIGVycm9yOiBcIkFkbWluIGFjY2VzcyByZXF1aXJlZC5cIiB9LCB7IHN0YXR1czogNDAzIH0pO1xuICB9XG5cbiAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsKTtcbiAgY29uc3QgZGF5ID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJkYXlcIik/LnRyaW0oKSB8fCBcIlwiO1xuICBjb25zdCByZXF1ZXN0ZWRab25lID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJ6b25lXCIpPy50cmltKCkgfHwgXCJcIjtcbiAgY29uc3Qgc2NvcGUgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcInNjb3BlXCIpID09PSBcInpvbmVcIiA/IFwiem9uZVwiIDogXCJhbGxcIjtcbiAgY29uc3QgZm9ybWF0ID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJmb3JtYXRcIikgPT09IFwieGxzXCIgPyBcInhsc1wiIDogXCJjc3ZcIjtcbiAgaWYgKHNjb3BlID09PSBcInpvbmVcIiAmJiAhcmVxdWVzdGVkWm9uZSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgb2s6IGZhbHNlLCBlcnJvcjogXCJQbGVhc2Ugc2VsZWN0IGEgem9uZSBmb3Igem9uZS1zY29wZSByZXBvcnQuXCIgfSxcbiAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICk7XG4gIH1cbiAgY29uc3Qgem9uZSA9IHNjb3BlID09PSBcInpvbmVcIiA/IHJlcXVlc3RlZFpvbmUgOiBcIlwiO1xuICBjb25zdCBkYiA9IGdldERiUG9vbCgpO1xuXG4gIGNvbnN0IHBlb3BsZVdoZXJlID0gZGF5ID8gXCJkYXkgPSAkMTo6ZGF0ZVwiIDogXCJkYXkgPj0gY3VycmVudF9kYXRlXCI7XG4gIGNvbnN0IHBlb3BsZVBhcmFtcyA9IGRheSA/IFtkYXldIDogW107XG4gIGNvbnN0IHRvdGFsc1Jlc3VsdCA9IGF3YWl0IGRiLnF1ZXJ5KFxuICAgIGBzZWxlY3QgY29hbGVzY2Uoc3VtKGluX2NvdW50KSwgMCkgYXMgcGVvcGxlX2luLFxuICAgICAgICAgICAgY29hbGVzY2Uoc3VtKG91dF9jb3VudCksIDApIGFzIHBlb3BsZV9vdXRcbiAgICAgZnJvbSBjb3VudGluZ19zdGF0c19kYWlseVxuICAgICB3aGVyZSAke3Blb3BsZVdoZXJlfWAsXG4gICAgcGVvcGxlUGFyYW1zXG4gICk7XG5cbiAgY29uc3QgZmFjZVdoZXJlID0gZGF5ID8gXCJkYXkgPSAkMTo6ZGF0ZVwiIDogXCJkYXkgPj0gY3VycmVudF9kYXRlXCI7XG4gIGNvbnN0IGZhY2VQYXJhbXMgPSBkYXkgPyBbZGF5XSA6IFtdO1xuICBjb25zdCBmYWNlUmVzdWx0ID0gYXdhaXQgZGIucXVlcnkoXG4gICAgYHNlbGVjdFxuICAgICAgICBjb2FsZXNjZShzdW0obWFsZSksIDApIGFzIG1hbGVfY291bnQsXG4gICAgICAgIGNvYWxlc2NlKHN1bShmZW1hbGUpLCAwKSBhcyBmZW1hbGVfY291bnQsXG4gICAgICAgIGNvYWxlc2NlKHN1bSh1bmtub3duX2dlbmRlciksIDApIGFzIHVua25vd25fY291bnQsXG4gICAgICAgIGNvYWxlc2NlKHN1bShhZ2VfY2hpbGQpLCAwKSBhcyBjaGlsZF9jb3VudCxcbiAgICAgICAgY29hbGVzY2Uoc3VtKGFnZV90ZWVuKSwgMCkgYXMgdGVlbl9jb3VudCxcbiAgICAgICAgY29hbGVzY2Uoc3VtKGFnZV95b3VuZ19hZHVsdCksIDApIGFzIHlvdW5nX2NvdW50LFxuICAgICAgICBjb2FsZXNjZShzdW0oYWdlX21pZGRsZV9hZ2UpLCAwKSBhcyBtaWRkbGVfY291bnQsXG4gICAgICAgIGNvYWxlc2NlKHN1bShhZ2Vfc2VuaW9yKSwgMCkgYXMgc2VuaW9yX2NvdW50LFxuICAgICAgICBjb2FsZXNjZShzdW0oYWdlX3Vua25vd24pLCAwKSBhcyBhZ2VfdW5rbm93bl9jb3VudFxuICAgICBmcm9tIGZhY2Vfc3RhdHNfZGFpbHlcbiAgICAgd2hlcmUgJHtmYWNlV2hlcmV9YCxcbiAgICBmYWNlUGFyYW1zXG4gICk7XG5cbiAgY29uc3Qgem9uZVBhcmFtcyA9IHpvbmUgPyBbem9uZSwgLi4uKGRheSA/IFtkYXldIDogW10pXSA6IGRheSA/IFtkYXldIDogW107XG4gIGNvbnN0IHpvbmVDb25kaXRpb24gPSB6b25lID8gXCJjaC56b25lID0gJDFcIiA6IFwiMT0xXCI7XG4gIGNvbnN0IGRheUNvbmRpdGlvbiA9IGRheSA/IGBhbmQgcC5kYXkgPSAkJHt6b25lID8gMiA6IDF9OjpkYXRlYCA6IFwiYW5kIHAuZGF5ID49IGN1cnJlbnRfZGF0ZVwiO1xuICBjb25zdCB6b25lUGVvcGxlUmVzdWx0ID0gYXdhaXQgZGIucXVlcnkoXG4gICAgYHNlbGVjdCBjb2FsZXNjZShzdW0ocC5pbl9jb3VudCksIDApIGFzIHBlb3BsZV9pbixcbiAgICAgICAgICAgIGNvYWxlc2NlKHN1bShwLm91dF9jb3VudCksIDApIGFzIHBlb3BsZV9vdXRcbiAgICAgZnJvbSBjb3VudGluZ19zdGF0c19kYWlseSBwXG4gICAgIGpvaW4gY2hhbm5lbHMgY2ggb24gY2guY2FtZXJhX2lkID0gcC5jYW1lcmFfaWQgYW5kIGNoLmNoYW5uZWxfbm8gPSBwLmNoYW5uZWxfbm9cbiAgICAgd2hlcmUgJHt6b25lQ29uZGl0aW9ufSAke2RheUNvbmRpdGlvbn1gLFxuICAgIHpvbmVQYXJhbXNcbiAgKTtcblxuICBjb25zdCB6b25lRmFjZVBhcmFtcyA9IHpvbmUgPyBbem9uZSwgLi4uKGRheSA/IFtkYXldIDogW10pXSA6IGRheSA/IFtkYXldIDogW107XG4gIGNvbnN0IHpvbmVGYWNlQ29uZGl0aW9uID0gem9uZSA/IFwiY2guem9uZSA9ICQxXCIgOiBcIjE9MVwiO1xuICBjb25zdCB6b25lRmFjZURheUNvbmRpdGlvbiA9XG4gICAgZGF5XG4gICAgICA/IGBhbmQgZi5kYXkgPSAkJHt6b25lID8gMiA6IDF9OjpkYXRlYFxuICAgICAgOiBcImFuZCBmLmRheSA+PSBjdXJyZW50X2RhdGVcIjtcbiAgY29uc3Qgem9uZUZhY2VSZXN1bHQgPSBhd2FpdCBkYi5xdWVyeShcbiAgICBgc2VsZWN0IGNvYWxlc2NlKHN1bShmLnRvdGFsKSwgMCkgYXMgZmFjZXNfdG90YWwsXG4gICAgICAgICAgICBjb2FsZXNjZShzdW0oZi5tYWxlKSwgMCkgYXMgbWFsZV9jb3VudCxcbiAgICAgICAgICAgIGNvYWxlc2NlKHN1bShmLmZlbWFsZSksIDApIGFzIGZlbWFsZV9jb3VudCxcbiAgICAgICAgICAgIGNvYWxlc2NlKHN1bShmLnVua25vd25fZ2VuZGVyKSwgMCkgYXMgdW5rbm93bl9jb3VudFxuICAgICBmcm9tIGZhY2Vfc3RhdHNfZGFpbHkgZlxuICAgICBqb2luIGNoYW5uZWxzIGNoIG9uIGNoLmNhbWVyYV9pZCA9IGYuY2FtZXJhX2lkIGFuZCBjaC5jaGFubmVsX25vID0gZi5jaGFubmVsX25vXG4gICAgIHdoZXJlICR7em9uZUZhY2VDb25kaXRpb259ICR7em9uZUZhY2VEYXlDb25kaXRpb259YCxcbiAgICB6b25lRmFjZVBhcmFtc1xuICApO1xuXG4gIGNvbnN0IGRldGFpbHNQYXJhbXMgPSB6b25lID8gW3pvbmUsIC4uLihkYXkgPyBbZGF5XSA6IFtdKV0gOiBkYXkgPyBbZGF5XSA6IFtdO1xuICBjb25zdCBkZXRhaWxzWm9uZUNvbmRpdGlvbiA9IHpvbmUgPyBcImNoLnpvbmUgPSAkMVwiIDogXCIxPTFcIjtcbiAgY29uc3QgZGV0YWlsc0RheUpvaW5Db25kaXRpb24gPVxuICAgIGRheSA/IGBhbmQgcC5kYXkgPSAkJHt6b25lID8gMiA6IDF9OjpkYXRlYCA6IFwiYW5kIHAuZGF5ID49IGN1cnJlbnRfZGF0ZVwiO1xuICBjb25zdCBkZXRhaWxzUmVzdWx0ID0gYXdhaXQgZGIucXVlcnkoXG4gICAgYHNlbGVjdCBjLmlwLFxuICAgICAgICAgICAgY29hbGVzY2UoYy5uYW1lLCBjLmlwKSBhcyBjYW1lcmFfbmFtZSxcbiAgICAgICAgICAgIGNoLmNoYW5uZWxfbm8sXG4gICAgICAgICAgICBjb2FsZXNjZShjaC5uYW1lLCBjb25jYXQoJ0NoYW5uZWwgJywgY2guY2hhbm5lbF9ubzo6dGV4dCkpIGFzIGNoYW5uZWxfbmFtZSxcbiAgICAgICAgICAgIGNvYWxlc2NlKHN1bShwLmluX2NvdW50KSwgMCkgYXMgcGVvcGxlX2luLFxuICAgICAgICAgICAgY29hbGVzY2Uoc3VtKHAub3V0X2NvdW50KSwgMCkgYXMgcGVvcGxlX291dFxuICAgICBmcm9tIGNoYW5uZWxzIGNoXG4gICAgIGpvaW4gY2FtZXJhcyBjIG9uIGMuaWQgPSBjaC5jYW1lcmFfaWRcbiAgICAgbGVmdCBqb2luIGNvdW50aW5nX3N0YXRzX2RhaWx5IHBcbiAgICAgICBvbiBwLmNhbWVyYV9pZCA9IGNoLmNhbWVyYV9pZFxuICAgICAgYW5kIHAuY2hhbm5lbF9ubyA9IGNoLmNoYW5uZWxfbm9cbiAgICAgICR7ZGV0YWlsc0RheUpvaW5Db25kaXRpb259XG4gICAgIHdoZXJlICR7ZGV0YWlsc1pvbmVDb25kaXRpb259XG4gICAgIGdyb3VwIGJ5IGMuaXAsIGMubmFtZSwgY2guY2hhbm5lbF9ubywgY2gubmFtZVxuICAgICBvcmRlciBieSBjb2FsZXNjZShjLm5hbWUsIGMuaXApLCBjaC5jaGFubmVsX25vYCxcbiAgICBkZXRhaWxzUGFyYW1zXG4gICk7XG5cbiAgY29uc3QgdG90YWxzID0gdG90YWxzUmVzdWx0LnJvd3NbMF0gPz8ge307XG4gIGNvbnN0IGZhY2UgPSBmYWNlUmVzdWx0LnJvd3NbMF0gPz8ge307XG4gIGNvbnN0IHpvbmVQZW9wbGUgPSB6b25lUGVvcGxlUmVzdWx0LnJvd3NbMF0gPz8ge307XG4gIGNvbnN0IHpvbmVGYWNlID0gem9uZUZhY2VSZXN1bHQucm93c1swXSA/PyB7fTtcblxuICBjb25zdCBsaW5lczogc3RyaW5nW10gPSBbXTtcbiAgbGluZXMucHVzaChyb3coW1wicmVwb3J0X2RheVwiLCBkYXkgfHwgXCJ0b2RheVwiXSkpO1xuICBsaW5lcy5wdXNoKHJvdyhbXCJyZXBvcnRfc2NvcGVcIiwgc2NvcGVdKSk7XG4gIGxpbmVzLnB1c2gocm93KFtcInpvbmVfZmlsdGVyXCIsIHpvbmUgfHwgXCJhbGxcIl0pKTtcbiAgbGluZXMucHVzaChcIlwiKTtcbiAgbGluZXMucHVzaChyb3coW1wic2VjdGlvblwiLCBcIm1ldHJpY1wiLCBcInZhbHVlXCJdKSk7XG4gIGxpbmVzLnB1c2gocm93KFtcImFsbF9kZXZpY2VzXCIsIFwicGVvcGxlX2luXCIsIE51bWJlcih0b3RhbHMucGVvcGxlX2luID8/IDApXSkpO1xuICBsaW5lcy5wdXNoKHJvdyhbXCJhbGxfZGV2aWNlc1wiLCBcInBlb3BsZV9vdXRcIiwgTnVtYmVyKHRvdGFscy5wZW9wbGVfb3V0ID8/IDApXSkpO1xuICBsaW5lcy5wdXNoKHJvdyhbXCJhbGxfZGV2aWNlc1wiLCBcImdlbmRlcl9tYWxlXCIsIE51bWJlcihmYWNlLm1hbGVfY291bnQgPz8gMCldKSk7XG4gIGxpbmVzLnB1c2gocm93KFtcImFsbF9kZXZpY2VzXCIsIFwiZ2VuZGVyX2ZlbWFsZVwiLCBOdW1iZXIoZmFjZS5mZW1hbGVfY291bnQgPz8gMCldKSk7XG4gIGxpbmVzLnB1c2gocm93KFtcImFsbF9kZXZpY2VzXCIsIFwiZ2VuZGVyX3Vua25vd25cIiwgTnVtYmVyKGZhY2UudW5rbm93bl9jb3VudCA/PyAwKV0pKTtcbiAgbGluZXMucHVzaChyb3coW1wiYWxsX2RldmljZXNcIiwgXCJhZ2VfY2hpbGRcIiwgTnVtYmVyKGZhY2UuY2hpbGRfY291bnQgPz8gMCldKSk7XG4gIGxpbmVzLnB1c2gocm93KFtcImFsbF9kZXZpY2VzXCIsIFwiYWdlX3RlZW5cIiwgTnVtYmVyKGZhY2UudGVlbl9jb3VudCA/PyAwKV0pKTtcbiAgbGluZXMucHVzaChyb3coW1wiYWxsX2RldmljZXNcIiwgXCJhZ2VfeW91bmdfYWR1bHRcIiwgTnVtYmVyKGZhY2UueW91bmdfY291bnQgPz8gMCldKSk7XG4gIGxpbmVzLnB1c2gocm93KFtcImFsbF9kZXZpY2VzXCIsIFwiYWdlX21pZGRsZV9hZ2VcIiwgTnVtYmVyKGZhY2UubWlkZGxlX2NvdW50ID8/IDApXSkpO1xuICBsaW5lcy5wdXNoKHJvdyhbXCJhbGxfZGV2aWNlc1wiLCBcImFnZV9zZW5pb3JcIiwgTnVtYmVyKGZhY2Uuc2VuaW9yX2NvdW50ID8/IDApXSkpO1xuICBsaW5lcy5wdXNoKHJvdyhbXCJhbGxfZGV2aWNlc1wiLCBcImFnZV91bmtub3duXCIsIE51bWJlcihmYWNlLmFnZV91bmtub3duX2NvdW50ID8/IDApXSkpO1xuICBsaW5lcy5wdXNoKHJvdyhbXCJ6b25lX3Njb3BlXCIsIFwicGVvcGxlX2luXCIsIE51bWJlcih6b25lUGVvcGxlLnBlb3BsZV9pbiA/PyAwKV0pKTtcbiAgbGluZXMucHVzaChyb3coW1wiem9uZV9zY29wZVwiLCBcInBlb3BsZV9vdXRcIiwgTnVtYmVyKHpvbmVQZW9wbGUucGVvcGxlX291dCA/PyAwKV0pKTtcbiAgbGluZXMucHVzaChyb3coW1wiem9uZV9zY29wZVwiLCBcIm9jY3VwYW5jeVwiLCBOdW1iZXIoem9uZVBlb3BsZS5wZW9wbGVfaW4gPz8gMCkgLSBOdW1iZXIoem9uZVBlb3BsZS5wZW9wbGVfb3V0ID8/IDApXSkpO1xuICBsaW5lcy5wdXNoKHJvdyhbXCJ6b25lX3Njb3BlXCIsIFwiZmFjZXNfdG90YWxcIiwgTnVtYmVyKHpvbmVGYWNlLmZhY2VzX3RvdGFsID8/IDApXSkpO1xuICBsaW5lcy5wdXNoKHJvdyhbXCJ6b25lX3Njb3BlXCIsIFwiZ2VuZGVyX21hbGVcIiwgTnVtYmVyKHpvbmVGYWNlLm1hbGVfY291bnQgPz8gMCldKSk7XG4gIGxpbmVzLnB1c2gocm93KFtcInpvbmVfc2NvcGVcIiwgXCJnZW5kZXJfZmVtYWxlXCIsIE51bWJlcih6b25lRmFjZS5mZW1hbGVfY291bnQgPz8gMCldKSk7XG4gIGxpbmVzLnB1c2gocm93KFtcInpvbmVfc2NvcGVcIiwgXCJnZW5kZXJfdW5rbm93blwiLCBOdW1iZXIoem9uZUZhY2UudW5rbm93bl9jb3VudCA/PyAwKV0pKTtcbiAgbGluZXMucHVzaChcIlwiKTtcbiAgbGluZXMucHVzaChyb3coW1wic2VjdGlvblwiLCBcImNhbWVyYV9pcFwiLCBcImNhbWVyYV9uYW1lXCIsIFwiY2hhbm5lbF9ub1wiLCBcImNoYW5uZWxfbmFtZVwiLCBcInBlb3BsZV9pblwiLCBcInBlb3BsZV9vdXRcIiwgXCJvY2N1cGFuY3lcIl0pKTtcbiAgZm9yIChjb25zdCBlbnRyeSBvZiBkZXRhaWxzUmVzdWx0LnJvd3MpIHtcbiAgICBjb25zdCBpbkNvdW50ID0gTnVtYmVyKGVudHJ5LnBlb3BsZV9pbiA/PyAwKTtcbiAgICBjb25zdCBvdXRDb3VudCA9IE51bWJlcihlbnRyeS5wZW9wbGVfb3V0ID8/IDApO1xuICAgIGxpbmVzLnB1c2goXG4gICAgICByb3coW1xuICAgICAgICBcImNoYW5uZWxcIixcbiAgICAgICAgZW50cnkuaXAsXG4gICAgICAgIGVudHJ5LmNhbWVyYV9uYW1lLFxuICAgICAgICBOdW1iZXIoZW50cnkuY2hhbm5lbF9ubyksXG4gICAgICAgIGVudHJ5LmNoYW5uZWxfbmFtZSxcbiAgICAgICAgaW5Db3VudCxcbiAgICAgICAgb3V0Q291bnQsXG4gICAgICAgIE1hdGgubWF4KDAsIGluQ291bnQgLSBvdXRDb3VudClcbiAgICAgIF0pXG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0IHpvbmVQYXJ0ID0gem9uZSA/IGAtJHt6b25lLnJlcGxhY2UoL1xccysvZywgXCJfXCIpfWAgOiBcIlwiO1xuICBjb25zdCBkYXlQYXJ0ID0gZGF5IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxMCk7XG4gIGlmIChmb3JtYXQgPT09IFwieGxzXCIpIHtcbiAgICBjb25zdCBzdW1tYXJ5Um93cyA9IGxpbmVzXG4gICAgICAuZmlsdGVyKChsaW5lKSA9PiBsaW5lLnN0YXJ0c1dpdGgoXCJhbGxfZGV2aWNlcyxcIikgfHwgbGluZS5zdGFydHNXaXRoKFwiem9uZV9zY29wZSxcIikpXG4gICAgICAubWFwKChsaW5lKSA9PiBsaW5lLnNwbGl0KFwiLFwiKSk7XG4gICAgY29uc3QgZGV0YWlsUm93cyA9IGRldGFpbHNSZXN1bHQucm93cy5tYXAoKGVudHJ5KSA9PiB7XG4gICAgICBjb25zdCBpbkNvdW50ID0gTnVtYmVyKGVudHJ5LnBlb3BsZV9pbiA/PyAwKTtcbiAgICAgIGNvbnN0IG91dENvdW50ID0gTnVtYmVyKGVudHJ5LnBlb3BsZV9vdXQgPz8gMCk7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBlbnRyeS5pcCxcbiAgICAgICAgZW50cnkuY2FtZXJhX25hbWUsXG4gICAgICAgIE51bWJlcihlbnRyeS5jaGFubmVsX25vKSxcbiAgICAgICAgZW50cnkuY2hhbm5lbF9uYW1lLFxuICAgICAgICBpbkNvdW50LFxuICAgICAgICBvdXRDb3VudCxcbiAgICAgICAgTWF0aC5tYXgoMCwgaW5Db3VudCAtIG91dENvdW50KVxuICAgICAgXTtcbiAgICB9KTtcbiAgICBjb25zdCBodG1sID0gYDwhZG9jdHlwZSBodG1sPjxodG1sPjxoZWFkPjxtZXRhIGNoYXJzZXQ9XCJ1dGYtOFwiIC8+PC9oZWFkPjxib2R5PlxuICAgICAgPHRhYmxlIGJvcmRlcj1cIjFcIj5cbiAgICAgICAgPHRyPjx0aD5yZXBvcnRfZGF5PC90aD48dGQ+JHtodG1sRXNjYXBlKGRheSB8fCBcInRvZGF5XCIpfTwvdGQ+PC90cj5cbiAgICAgICAgPHRyPjx0aD5yZXBvcnRfc2NvcGU8L3RoPjx0ZD4ke2h0bWxFc2NhcGUoc2NvcGUpfTwvdGQ+PC90cj5cbiAgICAgICAgPHRyPjx0aD56b25lX2ZpbHRlcjwvdGg+PHRkPiR7aHRtbEVzY2FwZSh6b25lIHx8IFwiYWxsXCIpfTwvdGQ+PC90cj5cbiAgICAgIDwvdGFibGU+XG4gICAgICA8YnIgLz5cbiAgICAgIDx0YWJsZSBib3JkZXI9XCIxXCI+XG4gICAgICAgIDx0cj48dGg+c2VjdGlvbjwvdGg+PHRoPm1ldHJpYzwvdGg+PHRoPnZhbHVlPC90aD48L3RyPlxuICAgICAgICAke3N1bW1hcnlSb3dzXG4gICAgICAgICAgLm1hcChcbiAgICAgICAgICAgIChyKSA9PlxuICAgICAgICAgICAgICBgPHRyPjx0ZD4ke2h0bWxFc2NhcGUoclswXSl9PC90ZD48dGQ+JHtodG1sRXNjYXBlKHJbMV0pfTwvdGQ+PHRkPiR7aHRtbEVzY2FwZShyWzJdKX08L3RkPjwvdHI+YFxuICAgICAgICAgIClcbiAgICAgICAgICAuam9pbihcIlwiKX1cbiAgICAgIDwvdGFibGU+XG4gICAgICA8YnIgLz5cbiAgICAgIDx0YWJsZSBib3JkZXI9XCIxXCI+XG4gICAgICAgIDx0cj48dGg+Y2FtZXJhX2lwPC90aD48dGg+Y2FtZXJhX25hbWU8L3RoPjx0aD5jaGFubmVsX25vPC90aD48dGg+Y2hhbm5lbF9uYW1lPC90aD48dGg+cGVvcGxlX2luPC90aD48dGg+cGVvcGxlX291dDwvdGg+PHRoPm9jY3VwYW5jeTwvdGg+PC90cj5cbiAgICAgICAgJHtkZXRhaWxSb3dzXG4gICAgICAgICAgLm1hcChcbiAgICAgICAgICAgIChyKSA9PlxuICAgICAgICAgICAgICBgPHRyPjx0ZD4ke2h0bWxFc2NhcGUoclswXSl9PC90ZD48dGQ+JHtodG1sRXNjYXBlKHJbMV0pfTwvdGQ+PHRkPiR7aHRtbEVzY2FwZShyWzJdKX08L3RkPjx0ZD4ke2h0bWxFc2NhcGUoclszXSl9PC90ZD48dGQ+JHtodG1sRXNjYXBlKHJbNF0pfTwvdGQ+PHRkPiR7aHRtbEVzY2FwZShyWzVdKX08L3RkPjx0ZD4ke2h0bWxFc2NhcGUocls2XSl9PC90ZD48L3RyPmBcbiAgICAgICAgICApXG4gICAgICAgICAgLmpvaW4oXCJcIil9XG4gICAgICA8L3RhYmxlPlxuICAgIDwvYm9keT48L2h0bWw+YDtcbiAgICBjb25zdCBmaWxlbmFtZSA9IGBjYW1lcmEtcmVwb3J0LSR7ZGF5UGFydH0ke3pvbmVQYXJ0fS54bHNgO1xuICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKGh0bWwsIHtcbiAgICAgIHN0YXR1czogMjAwLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbDsgY2hhcnNldD11dGYtOFwiLFxuICAgICAgICBcIkNvbnRlbnQtRGlzcG9zaXRpb25cIjogYGF0dGFjaG1lbnQ7IGZpbGVuYW1lPVxcXCIke2ZpbGVuYW1lfVxcXCJgXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBmaWxlbmFtZSA9IGBjYW1lcmEtcmVwb3J0LSR7ZGF5UGFydH0ke3pvbmVQYXJ0fS5jc3ZgO1xuICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShsaW5lcy5qb2luKFwiXFxuXCIpLCB7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgaGVhZGVyczoge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJ0ZXh0L2NzdjsgY2hhcnNldD11dGYtOFwiLFxuICAgICAgXCJDb250ZW50LURpc3Bvc2l0aW9uXCI6IGBhdHRhY2htZW50OyBmaWxlbmFtZT1cXFwiJHtmaWxlbmFtZX1cXFwiYFxuICAgIH1cbiAgfSk7XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0U2Vzc2lvbkZyb21SZXF1ZXN0IiwiZ2V0RGJQb29sIiwiY3N2RXNjYXBlIiwidmFsdWUiLCJyYXciLCJ1bmRlZmluZWQiLCJTdHJpbmciLCJ0ZXN0IiwicmVwbGFjZSIsInJvdyIsInZhbHVlcyIsIm1hcCIsImpvaW4iLCJodG1sRXNjYXBlIiwiR0VUIiwicmVxIiwic2Vzc2lvbiIsImpzb24iLCJvayIsImVycm9yIiwic3RhdHVzIiwicm9sZSIsInVybCIsIlVSTCIsImRheSIsInNlYXJjaFBhcmFtcyIsImdldCIsInRyaW0iLCJyZXF1ZXN0ZWRab25lIiwic2NvcGUiLCJmb3JtYXQiLCJ6b25lIiwiZGIiLCJwZW9wbGVXaGVyZSIsInBlb3BsZVBhcmFtcyIsInRvdGFsc1Jlc3VsdCIsInF1ZXJ5IiwiZmFjZVdoZXJlIiwiZmFjZVBhcmFtcyIsImZhY2VSZXN1bHQiLCJ6b25lUGFyYW1zIiwiem9uZUNvbmRpdGlvbiIsImRheUNvbmRpdGlvbiIsInpvbmVQZW9wbGVSZXN1bHQiLCJ6b25lRmFjZVBhcmFtcyIsInpvbmVGYWNlQ29uZGl0aW9uIiwiem9uZUZhY2VEYXlDb25kaXRpb24iLCJ6b25lRmFjZVJlc3VsdCIsImRldGFpbHNQYXJhbXMiLCJkZXRhaWxzWm9uZUNvbmRpdGlvbiIsImRldGFpbHNEYXlKb2luQ29uZGl0aW9uIiwiZGV0YWlsc1Jlc3VsdCIsInRvdGFscyIsInJvd3MiLCJmYWNlIiwiem9uZVBlb3BsZSIsInpvbmVGYWNlIiwibGluZXMiLCJwdXNoIiwiTnVtYmVyIiwicGVvcGxlX2luIiwicGVvcGxlX291dCIsIm1hbGVfY291bnQiLCJmZW1hbGVfY291bnQiLCJ1bmtub3duX2NvdW50IiwiY2hpbGRfY291bnQiLCJ0ZWVuX2NvdW50IiwieW91bmdfY291bnQiLCJtaWRkbGVfY291bnQiLCJzZW5pb3JfY291bnQiLCJhZ2VfdW5rbm93bl9jb3VudCIsImZhY2VzX3RvdGFsIiwiZW50cnkiLCJpbkNvdW50Iiwib3V0Q291bnQiLCJpcCIsImNhbWVyYV9uYW1lIiwiY2hhbm5lbF9ubyIsImNoYW5uZWxfbmFtZSIsIk1hdGgiLCJtYXgiLCJ6b25lUGFydCIsImRheVBhcnQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzbGljZSIsInN1bW1hcnlSb3dzIiwiZmlsdGVyIiwibGluZSIsInN0YXJ0c1dpdGgiLCJzcGxpdCIsImRldGFpbFJvd3MiLCJodG1sIiwiciIsImZpbGVuYW1lIiwiaGVhZGVycyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/report/download/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createSession: () => (/* binding */ createSession),\n/* harmony export */   getSessionCookieName: () => (/* binding */ getSessionCookieName),\n/* harmony export */   getSessionFromRequest: () => (/* binding */ getSessionFromRequest),\n/* harmony export */   getSessionTtlSeconds: () => (/* binding */ getSessionTtlSeconds),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   parseCookies: () => (/* binding */ parseCookies),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword),\n/* harmony export */   verifySession: () => (/* binding */ verifySession)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nconst SESSION_COOKIE = \"session\";\nconst SESSION_TTL_SECONDS = 60 * 60 * 12;\nconst getSecret = ()=>process.env.AUTH_SECRET || \"dev-secret\";\nconst base64urlEncode = (value)=>Buffer.from(value).toString(\"base64url\");\nconst base64urlDecode = (value)=>Buffer.from(value, \"base64url\").toString(\"utf8\");\nconst sign = (value)=>crypto__WEBPACK_IMPORTED_MODULE_0___default().createHmac(\"sha256\", getSecret()).update(value).digest(\"base64url\");\nfunction createSession(username, role) {\n    const exp = Date.now() + SESSION_TTL_SECONDS * 1000;\n    const payload = {\n        username,\n        role,\n        exp\n    };\n    const payloadEncoded = base64urlEncode(JSON.stringify(payload));\n    const token = `${payloadEncoded}.${sign(payloadEncoded)}`;\n    return {\n        token,\n        exp\n    };\n}\nfunction verifySession(token) {\n    if (!token) return null;\n    const [payloadEncoded, signature] = token.split(\".\");\n    if (!payloadEncoded || !signature) return null;\n    if (sign(payloadEncoded) !== signature) return null;\n    try {\n        const payload = JSON.parse(base64urlDecode(payloadEncoded));\n        if (!payload?.exp || Date.now() > payload.exp) return null;\n        return payload;\n    } catch  {\n        return null;\n    }\n}\nfunction parseCookies(header) {\n    if (!header) return {};\n    return header.split(\";\").reduce((acc, part)=>{\n        const [rawKey, ...rawValue] = part.trim().split(\"=\");\n        if (!rawKey) return acc;\n        acc[rawKey] = decodeURIComponent(rawValue.join(\"=\"));\n        return acc;\n    }, {});\n}\nfunction getSessionFromRequest(req) {\n    const cookies = parseCookies(req.headers.get(\"cookie\"));\n    return verifySession(cookies[SESSION_COOKIE]);\n}\nfunction getSessionCookieName() {\n    return SESSION_COOKIE;\n}\nfunction getSessionTtlSeconds() {\n    return SESSION_TTL_SECONDS;\n}\nfunction hashPassword(password) {\n    const salt = crypto__WEBPACK_IMPORTED_MODULE_0___default().randomBytes(16).toString(\"hex\");\n    const iterations = 120000;\n    const hash = crypto__WEBPACK_IMPORTED_MODULE_0___default().pbkdf2Sync(password, salt, iterations, 32, \"sha256\").toString(\"hex\");\n    return `pbkdf2$${iterations}$${salt}$${hash}`;\n}\nfunction verifyPassword(password, stored) {\n    const [scheme, iterationsRaw, salt, hash] = stored.split(\"$\");\n    if (scheme !== \"pbkdf2\" || !iterationsRaw || !salt || !hash) return false;\n    const iterations = Number(iterationsRaw);\n    if (!Number.isFinite(iterations) || iterations <= 0) return false;\n    const derived = crypto__WEBPACK_IMPORTED_MODULE_0___default().pbkdf2Sync(password, salt, iterations, 32, \"sha256\").toString(\"hex\");\n    return crypto__WEBPACK_IMPORTED_MODULE_0___default().timingSafeEqual(Buffer.from(hash, \"hex\"), Buffer.from(derived, \"hex\"));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUk0QixXQUFXLFlBQVksQ0FBQ0MsaUJBQWlCLENBQUNSLFFBQVEsQ0FBQ0csTUFBTSxPQUFPO0lBQ3BFLE1BQU1ELGFBQWFPLE9BQU9EO0lBQzFCLElBQUksQ0FBQ0MsT0FBT0MsUUFBUSxDQUFDUixlQUFlQSxjQUFjLEdBQUcsT0FBTztJQUM1RCxNQUFNUyxVQUFVOUQsd0RBQ0gsQ0FBQ2tELFVBQVVDLE1BQU1FLFlBQVksSUFBSSxVQUMzQzFDLFFBQVEsQ0FBQztJQUNaLE9BQU9YLDZEQUFzQixDQUFDUyxPQUFPQyxJQUFJLENBQUM0QyxNQUFNLFFBQVE3QyxPQUFPQyxJQUFJLENBQUNvRCxTQUFTO0FBQy9FIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FtLWFuYWx5c2lzLy4vbGliL2F1dGgudHM/YmY3ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcblxuZXhwb3J0IHR5cGUgVXNlclJvbGUgPSBcImFkbWluXCIgfCBcInVzZXJcIjtcblxudHlwZSBTZXNzaW9uUGF5bG9hZCA9IHtcbiAgdXNlcm5hbWU6IHN0cmluZztcbiAgcm9sZTogVXNlclJvbGU7XG4gIGV4cDogbnVtYmVyO1xufTtcblxuY29uc3QgU0VTU0lPTl9DT09LSUUgPSBcInNlc3Npb25cIjtcbmNvbnN0IFNFU1NJT05fVFRMX1NFQ09ORFMgPSA2MCAqIDYwICogMTI7XG5cbmNvbnN0IGdldFNlY3JldCA9ICgpID0+IHByb2Nlc3MuZW52LkFVVEhfU0VDUkVUIHx8IFwiZGV2LXNlY3JldFwiO1xuXG5jb25zdCBiYXNlNjR1cmxFbmNvZGUgPSAodmFsdWU6IHN0cmluZykgPT4gQnVmZmVyLmZyb20odmFsdWUpLnRvU3RyaW5nKFwiYmFzZTY0dXJsXCIpO1xuY29uc3QgYmFzZTY0dXJsRGVjb2RlID0gKHZhbHVlOiBzdHJpbmcpID0+IEJ1ZmZlci5mcm9tKHZhbHVlLCBcImJhc2U2NHVybFwiKS50b1N0cmluZyhcInV0ZjhcIik7XG5cbmNvbnN0IHNpZ24gPSAodmFsdWU6IHN0cmluZykgPT5cbiAgY3J5cHRvLmNyZWF0ZUhtYWMoXCJzaGEyNTZcIiwgZ2V0U2VjcmV0KCkpLnVwZGF0ZSh2YWx1ZSkuZGlnZXN0KFwiYmFzZTY0dXJsXCIpO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2Vzc2lvbih1c2VybmFtZTogc3RyaW5nLCByb2xlOiBVc2VyUm9sZSkge1xuICBjb25zdCBleHAgPSBEYXRlLm5vdygpICsgU0VTU0lPTl9UVExfU0VDT05EUyAqIDEwMDA7XG4gIGNvbnN0IHBheWxvYWQ6IFNlc3Npb25QYXlsb2FkID0geyB1c2VybmFtZSwgcm9sZSwgZXhwIH07XG4gIGNvbnN0IHBheWxvYWRFbmNvZGVkID0gYmFzZTY0dXJsRW5jb2RlKEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKTtcbiAgY29uc3QgdG9rZW4gPSBgJHtwYXlsb2FkRW5jb2RlZH0uJHtzaWduKHBheWxvYWRFbmNvZGVkKX1gO1xuICByZXR1cm4geyB0b2tlbiwgZXhwIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2ZXJpZnlTZXNzaW9uKHRva2VuOiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgaWYgKCF0b2tlbikgcmV0dXJuIG51bGw7XG4gIGNvbnN0IFtwYXlsb2FkRW5jb2RlZCwgc2lnbmF0dXJlXSA9IHRva2VuLnNwbGl0KFwiLlwiKTtcbiAgaWYgKCFwYXlsb2FkRW5jb2RlZCB8fCAhc2lnbmF0dXJlKSByZXR1cm4gbnVsbDtcbiAgaWYgKHNpZ24ocGF5bG9hZEVuY29kZWQpICE9PSBzaWduYXR1cmUpIHJldHVybiBudWxsO1xuICB0cnkge1xuICAgIGNvbnN0IHBheWxvYWQgPSBKU09OLnBhcnNlKGJhc2U2NHVybERlY29kZShwYXlsb2FkRW5jb2RlZCkpIGFzIFNlc3Npb25QYXlsb2FkO1xuICAgIGlmICghcGF5bG9hZD8uZXhwIHx8IERhdGUubm93KCkgPiBwYXlsb2FkLmV4cCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHBheWxvYWQ7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUNvb2tpZXMoaGVhZGVyOiBzdHJpbmcgfCBudWxsKSB7XG4gIGlmICghaGVhZGVyKSByZXR1cm4ge307XG4gIHJldHVybiBoZWFkZXIuc3BsaXQoXCI7XCIpLnJlZHVjZSgoYWNjLCBwYXJ0KSA9PiB7XG4gICAgY29uc3QgW3Jhd0tleSwgLi4ucmF3VmFsdWVdID0gcGFydC50cmltKCkuc3BsaXQoXCI9XCIpO1xuICAgIGlmICghcmF3S2V5KSByZXR1cm4gYWNjO1xuICAgIGFjY1tyYXdLZXldID0gZGVjb2RlVVJJQ29tcG9uZW50KHJhd1ZhbHVlLmpvaW4oXCI9XCIpKTtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlc3Npb25Gcm9tUmVxdWVzdChyZXE6IFJlcXVlc3QpIHtcbiAgY29uc3QgY29va2llcyA9IHBhcnNlQ29va2llcyhyZXEuaGVhZGVycy5nZXQoXCJjb29raWVcIikpO1xuICByZXR1cm4gdmVyaWZ5U2Vzc2lvbihjb29raWVzW1NFU1NJT05fQ09PS0lFXSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTZXNzaW9uQ29va2llTmFtZSgpIHtcbiAgcmV0dXJuIFNFU1NJT05fQ09PS0lFO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2Vzc2lvblR0bFNlY29uZHMoKSB7XG4gIHJldHVybiBTRVNTSU9OX1RUTF9TRUNPTkRTO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFzaFBhc3N3b3JkKHBhc3N3b3JkOiBzdHJpbmcpIHtcbiAgY29uc3Qgc2FsdCA9IGNyeXB0by5yYW5kb21CeXRlcygxNikudG9TdHJpbmcoXCJoZXhcIik7XG4gIGNvbnN0IGl0ZXJhdGlvbnMgPSAxMjAwMDA7XG4gIGNvbnN0IGhhc2ggPSBjcnlwdG9cbiAgICAucGJrZGYyU3luYyhwYXNzd29yZCwgc2FsdCwgaXRlcmF0aW9ucywgMzIsIFwic2hhMjU2XCIpXG4gICAgLnRvU3RyaW5nKFwiaGV4XCIpO1xuICByZXR1cm4gYHBia2RmMiQke2l0ZXJhdGlvbnN9JCR7c2FsdH0kJHtoYXNofWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2ZXJpZnlQYXNzd29yZChwYXNzd29yZDogc3RyaW5nLCBzdG9yZWQ6IHN0cmluZykge1xuICBjb25zdCBbc2NoZW1lLCBpdGVyYXRpb25zUmF3LCBzYWx0LCBoYXNoXSA9IHN0b3JlZC5zcGxpdChcIiRcIik7XG4gIGlmIChzY2hlbWUgIT09IFwicGJrZGYyXCIgfHwgIWl0ZXJhdGlvbnNSYXcgfHwgIXNhbHQgfHwgIWhhc2gpIHJldHVybiBmYWxzZTtcbiAgY29uc3QgaXRlcmF0aW9ucyA9IE51bWJlcihpdGVyYXRpb25zUmF3KTtcbiAgaWYgKCFOdW1iZXIuaXNGaW5pdGUoaXRlcmF0aW9ucykgfHwgaXRlcmF0aW9ucyA8PSAwKSByZXR1cm4gZmFsc2U7XG4gIGNvbnN0IGRlcml2ZWQgPSBjcnlwdG9cbiAgICAucGJrZGYyU3luYyhwYXNzd29yZCwgc2FsdCwgaXRlcmF0aW9ucywgMzIsIFwic2hhMjU2XCIpXG4gICAgLnRvU3RyaW5nKFwiaGV4XCIpO1xuICByZXR1cm4gY3J5cHRvLnRpbWluZ1NhZmVFcXVhbChCdWZmZXIuZnJvbShoYXNoLCBcImhleFwiKSwgQnVmZmVyLmZyb20oZGVyaXZlZCwgXCJoZXhcIikpO1xufVxuIl0sIm5hbWVzIjpbImNyeXB0byIsIlNFU1NJT05fQ09PS0lFIiwiU0VTU0lPTl9UVExfU0VDT05EUyIsImdldFNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJBVVRIX1NFQ1JFVCIsImJhc2U2NHVybEVuY29kZSIsInZhbHVlIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiYmFzZTY0dXJsRGVjb2RlIiwic2lnbiIsImNyZWF0ZUhtYWMiLCJ1cGRhdGUiLCJkaWdlc3QiLCJjcmVhdGVTZXNzaW9uIiwidXNlcm5hbWUiLCJyb2xlIiwiZXhwIiwiRGF0ZSIsIm5vdyIsInBheWxvYWQiLCJwYXlsb2FkRW5jb2RlZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b2tlbiIsInZlcmlmeVNlc3Npb24iLCJzaWduYXR1cmUiLCJzcGxpdCIsInBhcnNlIiwicGFyc2VDb29raWVzIiwiaGVhZGVyIiwicmVkdWNlIiwiYWNjIiwicGFydCIsInJhd0tleSIsInJhd1ZhbHVlIiwidHJpbSIsImRlY29kZVVSSUNvbXBvbmVudCIsImpvaW4iLCJnZXRTZXNzaW9uRnJvbVJlcXVlc3QiLCJyZXEiLCJjb29raWVzIiwiaGVhZGVycyIsImdldCIsImdldFNlc3Npb25Db29raWVOYW1lIiwiZ2V0U2Vzc2lvblR0bFNlY29uZHMiLCJoYXNoUGFzc3dvcmQiLCJwYXNzd29yZCIsInNhbHQiLCJyYW5kb21CeXRlcyIsIml0ZXJhdGlvbnMiLCJoYXNoIiwicGJrZGYyU3luYyIsInZlcmlmeVBhc3N3b3JkIiwic3RvcmVkIiwic2NoZW1lIiwiaXRlcmF0aW9uc1JhdyIsIk51bWJlciIsImlzRmluaXRlIiwiZGVyaXZlZCIsInRpbWluZ1NhZmVFcXVhbCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getDbPool: () => (/* binding */ getDbPool)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(pg__WEBPACK_IMPORTED_MODULE_0__);\n\nlet pool = null;\nfunction getDbPool() {\n    if (!pool) {\n        const connectionString = process.env.DATABASE_URL;\n        if (!connectionString) {\n            throw new Error(\"DATABASE_URL is not set.\");\n        }\n        pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n            connectionString\n        });\n    }\n    return pool;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZGIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQTBCO0FBRTFCLElBQUlDLE9BQW9CO0FBRWpCLFNBQVNDO0lBQ2QsSUFBSSxDQUFDRCxNQUFNO1FBQ1QsTUFBTUUsbUJBQW1CQyxRQUFRQyxHQUFHLENBQUNDLFlBQVk7UUFDakQsSUFBSSxDQUFDSCxrQkFBa0I7WUFDckIsTUFBTSxJQUFJSSxNQUFNO1FBQ2xCO1FBQ0FOLE9BQU8sSUFBSUQsb0NBQUlBLENBQUM7WUFBRUc7UUFBaUI7SUFDckM7SUFDQSxPQUFPRjtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FtLWFuYWx5c2lzLy4vbGliL2RiLnRzPzFkZjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUG9vbCB9IGZyb20gXCJwZ1wiO1xuXG5sZXQgcG9vbDogUG9vbCB8IG51bGwgPSBudWxsO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGJQb29sKCk6IFBvb2wge1xuICBpZiAoIXBvb2wpIHtcbiAgICBjb25zdCBjb25uZWN0aW9uU3RyaW5nID0gcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMO1xuICAgIGlmICghY29ubmVjdGlvblN0cmluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiREFUQUJBU0VfVVJMIGlzIG5vdCBzZXQuXCIpO1xuICAgIH1cbiAgICBwb29sID0gbmV3IFBvb2woeyBjb25uZWN0aW9uU3RyaW5nIH0pO1xuICB9XG4gIHJldHVybiBwb29sO1xufVxuIl0sIm5hbWVzIjpbIlBvb2wiLCJwb29sIiwiZ2V0RGJQb29sIiwiY29ubmVjdGlvblN0cmluZyIsInByb2Nlc3MiLCJlbnYiLCJEQVRBQkFTRV9VUkwiLCJFcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Freport%2Fdownload%2Froute&page=%2Fapi%2Freport%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freport%2Fdownload%2Froute.ts&appDir=%2FUsers%2Fameralyasin%2FDesktop%2Fcam%20analysis%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fameralyasin%2FDesktop%2Fcam%20analysis&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();